<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 
 <title>code is code</title>
 <link href="http://florianhanke.com/blog/atom.xml" rel="self"/>
 <link href="http://florianhanke.com/blog/"/>
 <updated>2011-04-14T15:32:03+10:00</updated>
 <id>http://florianhanke.com/blog/</id>
 <author>
   <name>Florian Hanke</name>
   <email>florian.hanke@gmail.com</email>
 </author>

 
 <entry>
   <title>Picky&nbsp;2.2.0</title>
   <link href="http://florianhanke.com/blog/2011/04/14/picky-two-point-two-point-oh.html"/>
   <updated>2011-04-14T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2011/04/14/picky-two-point-two-point-oh</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/&quot;&gt;Picky&lt;/a&gt; series on its workings.&lt;/p&gt;
&lt;p&gt;Picky 2.2.0 will be released shortly.&lt;/p&gt;
&lt;p&gt;What is good and new?&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Breaking &lt;span class=&quot;caps&quot;&gt;API&lt;/span&gt; change (Please read this if you already have Picky running)&lt;/li&gt;
	&lt;li&gt;More flexible sources (This is the cool stuff)&lt;/li&gt;
	&lt;li&gt;&lt;code&gt;rake search&lt;/code&gt; is now &lt;code&gt;picky search&lt;/code&gt;&lt;/li&gt;
	&lt;li&gt;Uses ActiveRecord/ActiveSupport 3.0&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Breaking &lt;span class=&quot;caps&quot;&gt;API&lt;/span&gt; change&lt;/h2&gt;
&lt;p&gt;2.2.0 will introduce an &lt;span class=&quot;caps&quot;&gt;API&lt;/span&gt; change that will break your existing, pre-2.2.0 server configuration.&lt;/p&gt;
&lt;p&gt;Instead of as second parameter, the data source is now passed in as an option, or called inside the configuration block.&lt;/p&gt;
&lt;p&gt;The old style:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Index::Memory.new :users, your_data_source do
  category :name, similarity: Similarity::DoubleMetaphone.new(3)
  category :age
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;has now become the&lt;/p&gt;
&lt;p&gt;new style:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Index::Memory.new :users, source: your_data_source do
  category :name, similarity: Similarity::DoubleMetaphone.new(3)
  category :age
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;OR&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Index::Memory.new :users do
  source   your_data_source
  category :name, similarity: Similarity::DoubleMetaphone.new(3)
  category :age
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Why?&lt;/p&gt;
&lt;p&gt;The old style was actually more correct, since an index &lt;strong&gt;needs&lt;/strong&gt; a data source. But I never really got friends with it, since it looked so unwieldy, especially when you have a &amp;#8220;long&amp;#8221; data source, like
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Sources::CSV.new(:abra, :ca, :dabra, file: 'some/file/that/is/somewhere.csv')&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;p&gt;The new style is much cleaner to look at. And Picky will tell you if you forgot the data source as early as possible.&lt;/p&gt;
&lt;p&gt;If you use the old style config, Picky will tell you how you need to update your config on server restart. But still, sorry about the breaking change!&lt;/p&gt;
&lt;h2&gt;Flexible sources&lt;/h2&gt;
&lt;p&gt;We&amp;#8217;ve completely rewritten the sources.&lt;/p&gt;
&lt;p&gt;Before 2.2.0, the data source needed to be an object that responds to the &lt;code&gt;#harvest&lt;/code&gt; method.&lt;/p&gt;
&lt;p&gt;In 2.2.0, it can be any object responding to the &lt;code&gt;#each&lt;/code&gt; method, if that method returns objects that at least respond to the &lt;code&gt;#id&lt;/code&gt; method and to any methods specified by the category method.&lt;/p&gt;
&lt;p&gt;Let me give you an example. Let&amp;#8217;s say we have some monkeys that we&amp;#8217;d like to index.&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;class Monkey
  attr_reader :id, :name, :color
  def initialize id, name, color
    @id, @name, @color = id, name, color
  end
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We&amp;#8217;ll create three monkeys and save them in an array:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;monkeys = [
  Monkey.new(1, 'pete', 'red'),
  Monkey.new(2, 'joey', 'green'),
  Monkey.new(3, 'hans', 'blue')
]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then, since an &lt;code&gt;Array&lt;/code&gt; has the &lt;code&gt;#each&lt;/code&gt; method, you can index it:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Index::Memory.new :monkeys do
  source   monkeys
  category :name
  category :couleur, :from =&amp;gt; :color # The couleur category will take its data from the #color method.
end&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;p&gt;Since each monkey has an &lt;code&gt;#id&lt;/code&gt;, a &lt;code&gt;#name&lt;/code&gt;, and a &lt;code&gt;#color&lt;/code&gt; method, Picky will happily index the monkeys for you. Not that the couleur category uses the &lt;code&gt;from&lt;/code&gt; option to define from where in the source it takes its data from.&lt;/p&gt;
&lt;p&gt;Hmmmm&amp;#8230; id method? You&amp;#8217;re probably thinking the same thing as I.&lt;/p&gt;
&lt;p&gt;MongoMapper and the new ActiveRecord both use a fluid style interface (see last post), whose proxies support &lt;code&gt;#each&lt;/code&gt;, and the yielded objects support &lt;code&gt;#id&lt;/code&gt; and various methods!&lt;/p&gt;
&lt;p&gt;So this becomes possible:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;class Book &amp;lt; ActiveRecord::Base; end

Book.establish_connection YAML.load(File.open('app/db.yml'))

Index::Memory.new :books do
  source   Book.order('title ASC')
  category :id
  category :title
  category :author
  category :year
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;See the first line in the index config block?&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Book.order('title ASC')&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This passes the AR proxy as source to the &lt;code&gt;books&lt;/code&gt; index. Since it provides a &lt;code&gt;#each&lt;/code&gt; method, and the yielded objects support &lt;code&gt;#id&lt;/code&gt; etc., Picky will index all books in a &lt;code&gt;title ASC&lt;/code&gt; order.&lt;/p&gt;
&lt;p&gt;I love it!&lt;/p&gt;
&lt;p&gt;Note that the old style sources still work. And for &lt;code&gt;ranged_category&lt;/code&gt;-s, it is still necessary to use the old style sources. We&amp;#8217;ll be working on that, but for the near future, use the old style sources for range/area/volume searches.&lt;/p&gt;
&lt;h2&gt;rake search &amp;#8594; picky search&lt;/h2&gt;
&lt;p&gt;See the last post.&lt;/p&gt;
&lt;p&gt;Since &lt;code&gt;rake search&lt;/code&gt; was project specific, but its functionality is actually &lt;span class=&quot;caps&quot;&gt;URL&lt;/span&gt; specific, I&amp;#8217;ve deprecated the rake task (it will tell you so), and created &lt;code&gt;picky search&lt;/code&gt; that you can use.&lt;/p&gt;
&lt;h2&gt;AR 3.0 / AS 3.0&lt;/h2&gt;
&lt;p&gt;In other news, Picky now uses AR 3.0 / AS 3.0.&lt;/p&gt;
&lt;p&gt;In your existing Gemfile, please update the line&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;gem 'activerecord',  '~&amp;gt; 2.3.8', :require =&amp;gt; 'active_record'&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;gem 'activesupport', '~&amp;gt; 3.0', :require =&amp;gt; 'active_support/core_ext'
gem 'activerecord',  '~&amp;gt; 3.0', :require =&amp;gt; 'active_record'&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Thanks!&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;that the &lt;span class=&quot;caps&quot;&gt;API&lt;/span&gt; broke a little.&lt;/li&gt;
	&lt;li&gt;that a new group of data sources is available.&lt;/li&gt;
	&lt;li&gt;that rake search is now picky search.&lt;/li&gt;
	&lt;li&gt;that Picky now uses AR 3.0 / AS 3.0.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new!&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Picky&nbsp;Data&nbsp;Sources&#58; Next&nbsp;Steps</title>
   <link href="http://florianhanke.com/blog/2011/04/12/picky-data-sources-next-steps.html"/>
   <updated>2011-04-12T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2011/04/12/picky-data-sources-next-steps</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its workings.&lt;/p&gt;
&lt;p&gt;For quite some time now I have been thinking about rewriting the Picky data sources.&lt;/p&gt;
&lt;p&gt;Although the ones that Picky use now work well, they do feel unelegant and unruby-ish.&lt;/p&gt;
&lt;p&gt;But I&amp;#8217;ll let you be the judge of that in the next part: How it works currently.&lt;/p&gt;
&lt;p&gt;After that, I&amp;#8217;ll talk about the problems with the current approach, and how I&amp;#8217;d like it to be and how this could be possible to do. Feedback welcome, as always!&lt;/p&gt;
&lt;h2&gt;How does it work now?&lt;/h2&gt;
&lt;p&gt;At the moment, every index needs a data source. So you might write:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;data_source = Sources::DB.new 'SELECT id, title, author, year FROM books', file: 'app/db.yml'
Index::Memory.new :books, data_source do
  # categories ...
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the example, the data is coming from a database which is defined in &lt;code&gt;app/db.yml&lt;/code&gt; (the &lt;code&gt;file&lt;/code&gt; option).&lt;/p&gt;
&lt;p&gt;Then, Picky&amp;#8217;s indexer takes a snapshot of the data using your query and saves it in another table. The query can be anything, with joins and conditions etc.&lt;/p&gt;
&lt;p&gt;Then, from this intermediate table, it will load batches of data, ordered in the way you ordered the results in your DB data source query.&lt;/p&gt;
&lt;p&gt;So if you happened to say&lt;/p&gt;
&lt;pre class=&quot;sh_sql&quot;&gt;&lt;code&gt;SELECT id, titulo as title, author, year FROM books ORDER BY year DESC&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;then your results would be ordered by &lt;code&gt;year&lt;/code&gt;, descending.&lt;/p&gt;
&lt;p&gt;Picky is really &lt;em&gt;data driven&lt;/em&gt;. If you sort the data in a certain way, it will be sorted like that in the results. (Well, inside each category combination, but let&amp;#8217;s not go into that for the moment. Just know that it will help your user.)&lt;/p&gt;
&lt;p&gt;By the way, don&amp;#8217;t hesitate to use &lt;code&gt;REGEXP&lt;/code&gt;, &lt;code&gt;SUBSTRING&lt;/code&gt; or other functions in your &lt;code&gt;SELECT&lt;/code&gt; statement to preprocess your data. It&amp;#8217;s incredibly powerful to preprocess your data.&lt;/p&gt;
&lt;h2&gt;How does it work in the code?&lt;/h2&gt;
&lt;p&gt;What Picky does is instantiate an indexer for each combination of (index, category, source, tokenizer). So as an example, it is indexing the &lt;code&gt;title&lt;/code&gt; category of a &lt;code&gt;books&lt;/code&gt; index, with data coming from a &lt;code&gt;db source&lt;/code&gt;, using the &lt;code&gt;indexing tokenizer&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;What the indexer first does is call the &lt;code&gt;harvest(index, category)&lt;/code&gt; method on the data source, passing it the current index and category. That&amp;#8217;s step 1.&lt;/p&gt;
&lt;p&gt;The source can then use the index and/or category to get the data from its backend.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/images/2011-04-12-data-sources.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;The source then gets the data from the backend and extracts the relevant parts. For the books index and title category it would do a select on the database using that information. Then, in step 2, it yields (slightly normalized) information back to the indexer, i.e. the id to index, and the data, the text to index.&lt;/p&gt;
&lt;p&gt;The indexer then, in step 3, tokenizes the data as you defined with the &lt;code&gt;default_indexing&lt;/code&gt; options, and finally, after some caching, writes it to the human readable index file.&lt;/p&gt;
&lt;p&gt;The human readable index files are located in the Picky server directory &lt;code&gt;index/{development,test,production}/books/&lt;/code&gt; where you&amp;#8217;ll find lots of files named &lt;code&gt;category_...&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;I urge you to look at them! Lots of indexing questions can be answered by just looking at &lt;code&gt;title_exact_index.json&lt;/code&gt;, for example.&lt;/p&gt;
&lt;p&gt;Note that all index files are encoded in json, with the exception of the similarity indexes, which are &lt;code&gt;Marshal&lt;/code&gt; dumped. So these are only human readable if you load them using &lt;code&gt;Marshal.load&lt;/code&gt;, I&amp;#8217;m afraid.&lt;/p&gt;
&lt;h2&gt;The problems&lt;/h2&gt;
&lt;p&gt;Although it all sounds nice, probably, there are three problems:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The indexer is a &amp;#8220;serial&amp;#8221; indexer. Meaning that for each category, it asks the database to give it the data for the current category. So for each id, it asks the database for each data category separately. So for id 1 it asks for the title, then, later, for the author etc.&lt;/li&gt;
	&lt;li&gt;In a similar vein, if I like to index correlated values, like geocoded data, that needs to be processed, it is simply not possible with the current indexer.&lt;/li&gt;
	&lt;li&gt;It is a bit unwieldy seeming for a user, imho. This could be a sign that it could be more elegant.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let&amp;#8217;s look at the problems in more detail:&lt;/p&gt;
&lt;h3&gt;Serial Indexer&lt;/h3&gt;
&lt;p&gt;The first problem, that Picky is going to the database for each category, is of a performance nature. Although it does not have much impact (you probably haven&amp;#8217;t noticed it yet), the way it is doing it now, it is still irking me that it does several return trips per id.&lt;/p&gt;
&lt;h3&gt;Correlated values not possible&lt;/h3&gt;
&lt;p&gt;Correlated values are not possible. What does this mean?&lt;/p&gt;
&lt;p&gt;Let&amp;#8217;s say that we have geocoded data, longitude and latitude. If you now try to do a geosearch by (ab)using the &lt;code&gt;ranged_category&lt;/code&gt; method, you will experience problems, the closer to the pole the location is. While on the equator, Picky will search around it in a nice square.&lt;/p&gt;
&lt;p&gt;But if you e.g. move to the north, since the longitudinal lines are closer and closer together, so will the ranged search distance. While 0.008 degrees might mean a kilometer on the equator, near the north pole it will be closer and closer to zero kilometers. So the square will be squished until it finally looks like a triangle.&lt;/p&gt;
&lt;p&gt;Depending on the cartographic method used, this might not be a problem for you. But it certainly is if you&amp;#8217;re looking at the whole earth. Now, if the categories were indexed together, Picky could recalculate the data for you such that the square area search (see one of the last blog posts) would be preserved.&lt;/p&gt;
&lt;p&gt;One approach to how this could look is this:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Index::Memory.new :books, data_source do
  geocoded_category :longitude, :latitude, 1.km
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In a &amp;#8220;parallel&amp;#8221; indexer, Picky could load both &lt;code&gt;longitude&lt;/code&gt; and &lt;code&gt;latitude&lt;/code&gt; and do corrections on the longitude/latitude to preprocess the data so it would return correctly geocoded results.&lt;/p&gt;
&lt;h3&gt;Elegance&lt;/h3&gt;
&lt;p&gt;This is the part where I am most unsure about. But this&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;data_source = Sources::DB.new 'SELECT id, title, author, year FROM books', file: 'app/db.yml'
Index::Memory.new :books, data_source do
  # categories ...
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;just doesn&amp;#8217;t look good. Granted, you need to inject a lot of information in a few lines:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Type of source (&lt;code&gt;DB&lt;/code&gt;)&lt;/li&gt;
	&lt;li&gt;Selection of data from the source (&lt;code&gt;SELECT&lt;/code&gt;)&lt;/li&gt;
	&lt;li&gt;Configuration of source (&lt;code&gt;file: 'app/db.yml'&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;But still, I&amp;#8217;d love it to be much more elegant.&lt;/p&gt;
&lt;p&gt;For quite some time, I wasn&amp;#8217;t sure what to do. There isn&amp;#8217;t a single nice interface of all the data sources. ActiveRecord does it this way, MongoMapper another etc. etc.&lt;/p&gt;
&lt;p&gt;So Simon from Berlin asked me last night about whether I had experience with Picky and MongoMapper. I don&amp;#8217;t, but it would certainly be cool to include it as a data source in one of the next versions of Picky.&lt;/p&gt;
&lt;p&gt;I took a closer look at it. Similar to the new way in Rails 3, it uses a fluid interface, where some methods just modify the query, while some are &amp;#8220;kicker&amp;#8221; methods that actually do something:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;User.where(:age.gt =&amp;gt; 27).sort(:age).all&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;More here, &lt;a href=&quot;http://railstips.org/blog/archives/2010/06/16/mongomapper-08-goodies-galore/&quot;&gt;http://railstips.org/blog/archives/2010/06/16/mongomapper-08-goodies-galore/&lt;/a&gt;. The &lt;code&gt;all&lt;/code&gt; method at the end of a chain would be a kicker method, loading all objects.&lt;/p&gt;
&lt;p&gt;That got me thinking.&lt;/p&gt;
&lt;h2&gt;How I would like it to be&lt;/h2&gt;
&lt;p&gt;Wouldn&amp;#8217;t it be nice if we could just, instead of a data source, just pass any object as data source, so for example, with MongoMapper:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Index::Memory.new :books, User.where(:age.gt =&amp;gt; 27).sort(:age) do
  category :name, similarity: Similarity::DoubleMetaphone.new(3)
  category :age
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Quite a bit sexier, imho. Since the result of the &lt;code&gt;sort(:age)&lt;/code&gt; method is a proxy that offers kicker and non-kicker methods, the Picky indexer could now call &lt;code&gt;each&lt;/code&gt; on it.&lt;/p&gt;
&lt;p&gt;The contract would then be that each object that is yielded by &lt;code&gt;#each&lt;/code&gt; must offer methods that are named like the categories (or named like the &lt;code&gt;from&lt;/code&gt; option – e.g. &lt;code&gt;category :name, from: surname&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;So, in the above example, each User object would have methods &lt;code&gt;#name&lt;/code&gt; and &lt;code&gt;#age&lt;/code&gt; such that Picky could extract the data.&lt;/p&gt;
&lt;p&gt;The cool thing with that would be that I could just pass in an Array of data. So, this would work (&lt;code&gt;a&lt;/code&gt;, &lt;code&gt;b&lt;/code&gt;, &lt;code&gt;c&lt;/code&gt; all respond to &lt;code&gt;#name&lt;/code&gt;):&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Index::Memory.new :books, [a, b, c] do
  category :name
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;What would we have to do to make this work in Picky?&lt;/p&gt;
&lt;h2&gt;How to get there?&lt;/h2&gt;
&lt;p&gt;First of all, Picky would need to be rewritten, or at least be partially rewritten to use a &amp;#8220;parallel&amp;#8221; indexer, where each category would be loaded along with the others. So loading data set 1 would load &lt;code&gt;title&lt;/code&gt;, &lt;code&gt;author&lt;/code&gt;, &lt;code&gt;year&lt;/code&gt; etc. at the same time. (Since some of these frameworks throw away the data after it has been yielded with &lt;code&gt;#each&lt;/code&gt;)&lt;/p&gt;
&lt;p&gt;The nice side-effect of this is that it opens real geosearch (or any combined category search) possibilities in Picky.&lt;/p&gt;
&lt;p&gt;Probably, the frameworks offering the &lt;code&gt;#each&lt;/code&gt; way would need to yield lazily, i.e. &lt;code&gt;#each&lt;/code&gt; should not preload all the data before yielding as the data in question might be huge. Or maybe load it in batches.&lt;/p&gt;
&lt;p&gt;How could we migrate from the current state to the new indexer?&lt;/p&gt;
&lt;p&gt;I suggest that before instantiating the indexer, the index would first look at the source. If the source &lt;code&gt;responds_to?(:each)&lt;/code&gt;, the parallel indexer would be used. And if not, the &amp;#8220;serial&amp;#8221; indexer would be used, doing things the old way.&lt;/p&gt;
&lt;p&gt;So the contract for parallel sources would be that they implement &lt;code&gt;#each&lt;/code&gt; in a way that would load the data in batches and only yield objects which respond to the category names.&lt;/p&gt;
&lt;p&gt;Let&amp;#8217;s see if we can get this working soon :)&lt;/p&gt;
&lt;p&gt;What I am wondering: Are we walking down a fool&amp;#8217;s path? Comment if you have an opinion about that, please.&lt;/p&gt;
&lt;h2&gt;Possible problems&lt;/h2&gt;
&lt;p&gt;One problem could be that we lose speed since we&amp;#8217;ll be instantiating lots of objects that respond to the categories. On the other hand, the return trips would not be necessary anymore.&lt;/p&gt;
&lt;p&gt;Another problem is that since we&amp;#8217;re just depending on &lt;code&gt;#each&lt;/code&gt;, we couldn&amp;#8217;t pass the source the index and category anymore. So choosing the right data would be the responsibility of the user. I do not think this to be a big problem.&lt;/p&gt;
&lt;h2&gt;Final remarks&lt;/h2&gt;
&lt;p&gt;Although I&amp;#8217;d like to make it more elegant, I&amp;#8217;d still like to preserve the old way of doing things. Sure,&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Index::Memory.new :users, User do
  category :name, similarity: Similarity::DoubleMetaphone.new(3)
  category :age
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;might look nicer than&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;user_source = Sources::DB.new 'SELECT id, name, age FROM users', file: 'app/db.yml'
Index::Memory.new :users, user_source do
  category :name, similarity: Similarity::DoubleMetaphone.new(3)
  category :age
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I&amp;#8217;d like the old way to be available, since doing the right &lt;code&gt;SELECT&lt;/code&gt; is incredibly useful.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;how Picky data sources work now.&lt;/li&gt;
	&lt;li&gt;how they ought to work.&lt;/li&gt;
	&lt;li&gt;that &lt;code&gt;#each&lt;/code&gt; would be more ruby-ish.&lt;/li&gt;
	&lt;li&gt;how a migration path could look like.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new!&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Searching with Picky&#58; In&nbsp;the&nbsp;Terminal</title>
   <link href="http://florianhanke.com/blog/2011/04/11/searching-with-picky-rake-search.html"/>
   <updated>2011-04-11T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2011/04/11/searching-with-picky-rake-search</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its workings. If you haven&amp;#8217;t tried it yet, do so in the &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;Getting Started&lt;/a&gt; section. It&amp;#8217;s quick and painless :)&lt;/p&gt;
&lt;p&gt;This post is about a fun little experimental toy I&amp;#8217;ve been working on: &lt;code&gt;picky search &amp;lt;url&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Update!&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;rake search&lt;/code&gt; is &lt;code&gt;picky search&lt;/code&gt; from 2.2.0 on.&lt;/p&gt;
&lt;h2&gt;picky search &amp;lt;url&amp;gt;?&lt;/h2&gt;
&lt;p&gt;Yes. While working on a server, I sometimes want to see if the search engine works correctly directly in the terminal (normally I use tests, but sometimes I need that quick look).&lt;/p&gt;
&lt;h2&gt;How do I use it?&lt;/h2&gt;
&lt;p&gt;See this short video (it&amp;#8217;s best to full-screen it):&lt;/p&gt;
&lt;p&gt;&lt;iframe src=&quot;http://player.vimeo.com/video/22216442&quot; width=&quot;600&quot; height=&quot;387&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Start a Picky server.&lt;/li&gt;
	&lt;li&gt;Then type &lt;code&gt;picky search /some/url&lt;/code&gt; (where &lt;code&gt;/some/url&lt;/code&gt; is a path – or url if not on this server – you&amp;#8217;ve defined using &lt;code&gt;route&lt;/code&gt; in &lt;code&gt;app/application.rb&lt;/code&gt;).&lt;/li&gt;
	&lt;li&gt;Then, just type away.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The result id count will update as you type.&lt;/p&gt;
&lt;p&gt;When pressing enter, the top 20 result ids will appear next to your search text.&lt;/p&gt;
&lt;p&gt;If you want to exit, just &lt;code&gt;Ctrl-C&lt;/code&gt;. That&amp;#8217;s it.&lt;/p&gt;
&lt;p&gt;Note that you need the picky-client &amp;amp; highline gem installed. But Picky will tell you so if you haven&amp;#8217;t.&lt;/p&gt;
&lt;h2&gt;How does it work?&lt;/h2&gt;
&lt;p&gt;I use the highline gem (by &lt;a href=&quot;http://twitter.com/jeg2&quot;&gt;@JEG2&lt;/a&gt;) to get single characters (using the appropriately named &lt;code&gt;get_character&lt;/code&gt;) from the user and then move the cursor around using &lt;code&gt;\e[#{amount}D&lt;/code&gt; (left) and &lt;code&gt;\e[#{amount}C&lt;/code&gt; (right), &lt;code&gt;print&lt;/code&gt; ing to the &lt;span class=&quot;caps&quot;&gt;STDOUT&lt;/span&gt; and &lt;code&gt;flush&lt;/code&gt; ing it a lot.&lt;/p&gt;
&lt;p&gt;If there is a gem which makes it easy to position objects in the terminal which update it (by being used in a visitor pattern or however), I&amp;#8217;d like to hear about it!&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;how you run a search directly in the terminal.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new!&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Searching with Picky&#58; Range/Area/Volume&nbsp;etc.&nbsp;Search</title>
   <link href="http://florianhanke.com/blog/2011/04/09/searching-with-picky-area-search.html"/>
   <updated>2011-04-09T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2011/04/09/searching-with-picky-area-search</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its workings. If you haven&amp;#8217;t tried it yet, do so in the &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;Getting Started&lt;/a&gt; section. It&amp;#8217;s quick and painless :)&lt;/p&gt;
&lt;p&gt;This post is all about searching areas, volumes, space and time – and more!&lt;/p&gt;
&lt;h2&gt;tl;dr&lt;/h2&gt;
&lt;p&gt;Using &lt;code&gt;ranged_category&lt;/code&gt; instead of &lt;code&gt;category&lt;/code&gt; in index definition lets you search inside numeric ranges (instead of exact or partial strings). Example:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;ranged_category :height,
                50,          # units &quot;around&quot; the searched value, here: meters
                precision: 5 # very high precision, 1% error&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Warp Area&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;#area&quot;&gt;Range Search&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;#areahow&quot;&gt;Range, how?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;#map&quot;&gt;Area Search&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;#volumetric&quot;&gt;Volume Search&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;#funky&quot;&gt;&amp;#8220;Find all locations in a thin slice of N47.11 to N47.13, whose names start with F, that are in height 362m to 462m&amp;#8221;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;#spacetime&quot;&gt;Space &amp;amp; Time Search&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;#radiuses&quot;&gt;Different Radiuses/Volume Sizes etc.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;#caveats&quot;&gt;Caveats&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;area&quot;&gt;Range Search&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;/blog/images/2011-04-09-intersection.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Picky is good at intersecting stuff – and guessing which of the intersections you actually are looking for.&lt;/p&gt;
&lt;p&gt;The pink part is where e.g. &amp;#8220;name:eisenhower&amp;#8221; and &amp;#8220;title:wa&amp;#8221;&amp;#174; intersects in a speech database, and Picky finds it. The blue part is where &amp;#8220;name:eisenhower&amp;#8221; and &amp;#8220;title:wa&amp;#8221;(rthog) intersect. Less interesting, and Picky thinks so too.&lt;/p&gt;
&lt;p&gt;Usually, what Picky does is intersecting these circles of words you are looking for, resulting in funky Venn diagrams that have so successfully been used in 60s style living rooms.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/images/2011-04-09-area.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Hey, doesn&amp;#8217;t a map have grids that intersect somehow? What if Picky could intersect the area between the x lines (light blue) with the area between the y lines (also light blue)?&lt;/p&gt;
&lt;p&gt;What we&amp;#8217;d get is the results in the pinkish area.&lt;/p&gt;
&lt;p&gt;This type of diagram has been successfully used by Piet Mondrian at the beginning of last century.&lt;/p&gt;
&lt;p&gt;Now, if we could pass Picky the median x value, and the median y value and get it to return the results in the pink area, wouldn&amp;#8217;t that be something?&lt;/p&gt;
&lt;p&gt;Indeed it would, and indeed it already can. You probably just didn&amp;#8217;t know.&lt;/p&gt;
&lt;h2 id=&quot;areahow&quot;&gt;But how can I do a range search?&lt;/h2&gt;
&lt;p&gt;Apart from searching exact or partial strings with the &lt;code&gt;#category&lt;/code&gt; method, Picky offers a &lt;code&gt;#ranged_category&lt;/code&gt; method for numerical values.&lt;/p&gt;
&lt;p&gt;Let me show you how it works. Let&amp;#8217;s say that I have a &lt;span class=&quot;caps&quot;&gt;CSV&lt;/span&gt; file, &lt;code&gt;mountains.csv&lt;/code&gt;, with the mountains of the world, from lowest to highest, in meters:&lt;/p&gt;
&lt;pre class=&quot;sh_csv&quot;&gt;&lt;code&gt;1, Tokelau (NZ), 5.0
...
124, Vaalserberg (NL), 321.9
...
78513, Mount Everest (NP), 8850.0&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we want the user to be able to enter&lt;/p&gt;
&lt;pre class=&quot;sh_search&quot;&gt;&lt;code&gt;200&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and get all the mountains that are +/- 50 meters in height away from 200.&lt;/p&gt;
&lt;p&gt;For that you use &lt;code&gt;ranged_category(name, units_around, options = {})&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;data_source = Sources::CSV.new(:location, :height, file: 'data/mountains.csv')
mountains = Index::Memory.new(:mountains, data_source) do
  category        :name
  ranged_category :height, 50, precision: 3 # 50 is the units around the searched height
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So we&amp;#8217;d have a name (that is searched with the default config, like text) and a height that is searched with a precision of 3, 50 meters around the number the user enters.&lt;/p&gt;
&lt;p&gt;What does the precision mean?&lt;/p&gt;
&lt;p&gt;Precision 1, the default, has 5% error and is really, really fast, and precision 5 has 1% error and is just fast. You can go up to wherever you want, but 5 is a good tradeoff if you need a precise result.&lt;/p&gt;
&lt;p&gt;Note that – since Picky does intersections – you can also search for height &lt;span class=&quot;caps&quot;&gt;AND&lt;/span&gt; name at the same time. If you add a full partial search option to the name category, &lt;code&gt;category :name, partial: Partial::Substring.new(from: 1)&lt;/code&gt; then when you search for example for&lt;/p&gt;
&lt;pre class=&quot;sh_search&quot;&gt;&lt;code&gt;300 va&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;you will find all the mountains from height 250 to 350 whose name starts with &amp;#8220;va&amp;#8221;. Nice eh?&lt;/p&gt;
&lt;h2 id=&quot;map&quot;&gt;Nice indeed, but can I use this for an area search?&lt;/h2&gt;
&lt;p&gt;Let&amp;#8217;s say I have a &lt;span class=&quot;caps&quot;&gt;CSV&lt;/span&gt; file, &lt;code&gt;swiss_places.csv&lt;/code&gt;, with all places, 20910 in all, in Switzerland, like so:&lt;/p&gt;
&lt;pre class=&quot;sh_csv&quot;&gt;&lt;code&gt;1,Zuger See,47.11667,8.48333
2,Zwischbergental,46.16667,8.13333
3,Zwischbergen,46.16667,8.11667
4,Zwingen,47.43825,7.53027
...
20910,Les 4 Vallées,46.17572,7.32142&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is the data. Then I tell Picky where to find the data (in the &lt;span class=&quot;caps&quot;&gt;CSV&lt;/span&gt;) and how to index it:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;data_source = Sources::CSV.new(:location, :north, :east, file: 'data/swiss_places.csv')
swiss_places = Index::Memory.new(:swiss_places, data_source) do
  category        :location
  ranged_category :north, 0.01, precision: 3
  ranged_category :east,  0.01, precision: 3
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This means that we can search for the location, and the north and the east value, with 0.01 leeway around the searched number. So entering 47.12 would find numbers in the range 47.11..47.13.&lt;/p&gt;
&lt;p&gt;Now, if you search for&lt;/p&gt;
&lt;pre class=&quot;sh_search&quot;&gt;&lt;code&gt;47.12, 8.48&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;you find the &amp;#8220;Zuger See&amp;#8221;.&lt;/p&gt;
&lt;p&gt;Since for Switzerland, the north and east coordinates are exclusive (one around 47, the other around 8.4), Picky knows what is what by itself.&lt;/p&gt;
&lt;p&gt;If your values aren&amp;#8217;t exclusive, for example both are in the range 1..3, then entering the search&lt;/p&gt;
&lt;pre class=&quot;sh_search&quot;&gt;&lt;code&gt;1.3, 2.4&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;might make Picky ask you which one is what. It&amp;#8217;s not clear if you want 1.3 from the one and 2.4 from the other, and voice versa. This can be remedied by exclusively specifying what is what:&lt;/p&gt;
&lt;pre class=&quot;sh_search&quot;&gt;&lt;code&gt;north:1.3, east:2.4&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The best thing is that you don&amp;#8217;t need to use the Picky interface. You could whip up a Javascript interface (of some area) where you click into and run searches on Picky, then returning results that are displayed in the area.&lt;/p&gt;
&lt;p&gt;But now, let&amp;#8217;s go a little crazy!&lt;/p&gt;
&lt;h2 id=&quot;volumetric&quot;&gt;Volumetric Search&lt;/h2&gt;
&lt;p&gt;Say, the swiss data also had heights:&lt;/p&gt;
&lt;pre class=&quot;sh_csv&quot;&gt;&lt;code&gt;1,Zuger See,47.11667,8.48333,410.0
2,Zwischbergental,46.16667,8.13333,
...
20910,Les 4 Vallées,46.17572,7.32142,1205.3&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Just add the new line in the index definition, and in the source:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;data_source = Sources::CSV.new(:location, :north, :east, :height, file: 'data/swiss_places.csv')
swiss_places = Index::Memory.new(:swiss_places, data_source) do
  ...
  ranged_category :height, 50
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Voilà!&lt;/p&gt;
&lt;pre class=&quot;sh_search&quot;&gt;&lt;code&gt;47.12, 8.48, 400&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This would make you find the &amp;#8220;Zugerberg&amp;#8221;, while using a height of 500 wouldn&amp;#8217;t.&lt;/p&gt;
&lt;h3 id=&quot;funky&quot;&gt;Let&amp;#8217;s get funky!&lt;/h3&gt;
&lt;p&gt;We don&amp;#8217;t need to use all categories:&lt;/p&gt;
&lt;pre class=&quot;sh_search&quot;&gt;&lt;code&gt;47.12, f*, 412&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Funky search, but this would find all locations in a thin band of north 47.11..47.13, whose names start with f, and that are in height 362..462.&lt;/p&gt;
&lt;p&gt;Let&amp;#8217;s add more dimensions.&lt;/p&gt;
&lt;h2 id=&quot;spacetime&quot;&gt;Space and Time&lt;/h2&gt;
&lt;p&gt;So how would we search in space and time? Space is easy, that is just a volumetric search.&lt;/p&gt;
&lt;p&gt;Now: How would you add in time?&lt;/p&gt;
&lt;p&gt;Probably you&amp;#8217;d index it in seconds from January 1st, 1970 or something like that, then define a ranged search with &amp;#8220;radius&amp;#8221; 1800. This would make Picky find things in the hour around the searched seconds since 1970.&lt;/p&gt;
&lt;h2 id=&quot;radiuses&quot;&gt;I want to be able to search in 1m, 10m, 100m&lt;/h2&gt;
&lt;p&gt;Now, as you saw, we looked for heights 50 meters around it using:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;ranged_category :height, 50&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;What if we want to search 1 meter, 10 meters, 100 meters around it, choosing as we go?&lt;/p&gt;
&lt;p&gt;This is accomplished by adding more searchable categories, like so. You name the category specifically, and tell Picky from where in the data source it should get the data, using the &lt;code&gt;from&lt;/code&gt; option.&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;ranged_category :height1,     1, from: height
ranged_category :height10,   10, from: height
ranged_category :height100, 100, from: height
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Choosing from the categories is done as usual. If you want 10 meters, search like this:&lt;/p&gt;
&lt;pre class=&quot;sh_search&quot;&gt;&lt;code&gt;height10:412&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This will find locations of heights 402..422.&lt;/p&gt;
&lt;h2 id=&quot;caveats&quot;&gt;Caveats&lt;/h2&gt;
&lt;p&gt;Actually, if you use the &lt;code&gt;ranged_category&lt;/code&gt; on a larger area on a ball, like earth. For example in Australia – the place I am staying in, currently – what you will find is that the more south you go, towards the pole, the less square and more rectangular your search area will get. This is because Picky does not correct the ball&amp;#8217;s sphere. I&amp;#8217;m working on it.&lt;/p&gt;
&lt;p&gt;So, Picky cannot handle your balls yet.&lt;/p&gt;
&lt;p&gt;For small countries it is still useful, and of course for lots of graph searches etc.&lt;/p&gt;
&lt;p&gt;Flat things it does marvellously. And super fast!&lt;/p&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;how Picky can search areas.&lt;/li&gt;
	&lt;li&gt;how Picky can search volumes.&lt;/li&gt;
	&lt;li&gt;how Picky can search any number of dimensions.&lt;/li&gt;
	&lt;li&gt;how you can choose any combination of areas and other features.&lt;/li&gt;
	&lt;li&gt;how you search in different ranges on the same thing/category.&lt;/li&gt;
	&lt;li&gt;that you cannot quite search on a ball, like earth.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new!&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>On Searching</title>
   <link href="http://florianhanke.com/blog/2011/03/30/on-searching.html"/>
   <updated>2011-03-30T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/03/30/on-searching</id>
   <content type="html">&lt;h2&gt;tl; dr&lt;/h2&gt;
&lt;p&gt;This post is about engineers, our pride in information gathering and organizing, and how we often fail in information searching.&lt;/p&gt;
&lt;p&gt;Also about different types of search engines.&lt;/p&gt;
&lt;h2&gt;Engineering&lt;/h2&gt;
&lt;p&gt;Imagine a structural engineer planning a bridge.&lt;/p&gt;
&lt;p&gt;How do you think does he approach the problem? Does he just build a standard concrete/steel bridge?&lt;/p&gt;
&lt;p&gt;Probably not. He analyzes the constraints put on it by various factors, monetary, environmental, political, and last but not least – time, and sets out to build the bridge that fits as many of these constraints as possible.&lt;/p&gt;
&lt;p&gt;Similarly with software engineering: We analyze various options, plan, code, release. (In this magical dream world I am conjuring up. But bear with me.)&lt;/p&gt;
&lt;p&gt;And most of the time, we do this well. An incredible number of blog posts, books etc. describe various options and tools in the software world that can be used as blueprints, tools, or inspiration to build our specific &amp;#8220;bridges&amp;#8221;.&lt;/p&gt;
&lt;h2&gt;Information gathering and structuring&lt;/h2&gt;
&lt;p&gt;When it is about collecting information, we are world masters.&lt;/p&gt;
&lt;p&gt;There is an enormous wealth of information regarding how to structure data, which database/key-value-store/glorified-hash etc. to use, when, and how.&lt;/p&gt;
&lt;p&gt;How to acquire users, how to aqcuire information from these users, also how to access this information through APIs and how to make information accessible and so on.&lt;/p&gt;
&lt;p&gt;Tell me the size of your valley, the amount and color of cars expected, and I can provide you a set of blueprints in a nice price range.&lt;/p&gt;
&lt;p&gt;This is great. But what happens when it is about making this information searchable? Not so great in my humble opinion.&lt;/p&gt;
&lt;h2&gt;Information searching&lt;/h2&gt;
&lt;p&gt;I&amp;#8217;ve recently experienced a few cases where the analysis for which search engine to use went something like this:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;#8220;Oh, we&amp;#8217;ve used it for project X, it will be great in project Y (totally different project).&amp;#8221;&lt;/li&gt;
	&lt;li&gt;&amp;#8220;Just use the gem in ActiveRecord, and it takes care of everything.&amp;#8221;&lt;/li&gt;
	&lt;li&gt;&amp;#8220;Search engine X is cool, Y recommended it on his blog yesterday!&amp;#8221;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;While I appreciate the strict time constraints often involved in projects, the above reasons should not be used by an engineer worth his salt.&lt;/p&gt;
&lt;p&gt;Yes, using search engine X will not end in disaster, and yes, it will return some results to the user.&lt;/p&gt;
&lt;p&gt;But instead of building an elegant bamboo bridge over the wide jungle river, perfect for one person, you built a concrete bridge.&lt;/p&gt;
&lt;p&gt;Yes, it works. Yes, a person can safely cross the river. But most of the jungle is destroyed. Nobody feels comfortable using it. The town next to it had to spend most of its money on it.&lt;/p&gt;
&lt;p&gt;What I am saying is: While you arrived through lots of reasoning why you use e.g. Redis over MongoDB, and can and will defend it if asked for your reasons – in information searching, this is often not the case.&lt;/p&gt;
&lt;p&gt;Or can you tell me why you used search engine X in your last project?&lt;/p&gt;
&lt;p&gt;I know that often the first step is information acquiring, and towards the end, project managers notice that they were so busy acquiring all this information, that they totally forgot to think about making this information properly searchable. Time constraints then trash sensible search engine selection.&lt;/p&gt;
&lt;p&gt;There are other reasons as to why searching is neglected, but this is one I most often experienced.&lt;/p&gt;
&lt;h2&gt;The resulting problem&lt;/h2&gt;
&lt;p&gt;Often the end result of our careless choice is that the coders are quite happy, and the end users are relatively happy. But not a good happy, more of an accepting happy. Yes, we can search, and we should be grateful for it.&lt;/p&gt;
&lt;p&gt;But are you really happy? Did you really put your engineering savvy into it to help your users advance?&lt;/p&gt;
&lt;p&gt;Not really, right?&lt;/p&gt;
&lt;h2&gt;What we need to do&lt;/h2&gt;
&lt;p&gt;Know your problem domain, your information structure. Know your options and tools too.&lt;/p&gt;
&lt;p&gt;Do you specifically need a realtime indexing search? There&amp;#8217;s &lt;a href=&quot;http://masanjin.net/whistlepig/&quot;&gt;one written in Ruby&lt;/a&gt; (just as an example for a rather special/specific search engine – not sure how far it is yet).&lt;/p&gt;
&lt;p&gt;Do you really need a full-text search? Do you know &lt;a href=&quot;http://en.wikipedia.org/wiki/Full_text_search&quot;&gt;what a full text search&lt;/a&gt; is? Do you know when to use one and also, when not? When is a &lt;a href=&quot;http://en.wikipedia.org/wiki/Semantic_search&quot;&gt;semantic search engine&lt;/a&gt; the better choice?&lt;/p&gt;
&lt;p&gt;Do you know the answers?&lt;/p&gt;
&lt;p&gt;Btw, not dissing full-text search engines to promote &lt;a href=&quot;http://florianhanke.com/picky/&quot;&gt;Picky&lt;/a&gt; (the semantic search engine) here ;) They&amp;#8217;re great.&lt;/p&gt;
&lt;p&gt;What I&amp;#8217;m criticizing is the indiscriminate choice by many of my peers. I&amp;#8217;m just trying to bring the point across that one should weigh the options, and decide based on reason.&lt;/p&gt;
&lt;h2&gt;Fallacy: Search Engines are hard&lt;/h2&gt;
&lt;p&gt;I guess that sometimes the problem is just that search engines seem like magic. Sure you most of the time know which knob to turn, but when something unexpected happens, you feel like a wet dog out in the wind.&lt;/p&gt;
&lt;p&gt;Search engines are easy, actually. Take some time and &lt;a href=&quot;http://en.wikipedia.org/wiki/Search_engine_(computing)&quot;&gt;read all about them&lt;/a&gt;, especially by following the links.&lt;/p&gt;
&lt;p&gt;Mind, blown?&lt;/p&gt;
&lt;h2&gt;Sidenote: Computer Science vs. &amp;#8220;Informatik&amp;#8221;&lt;/h2&gt;
&lt;p&gt;&amp;#8220;We want information. In-for-mation!&amp;#8221; &lt;a href=&quot;http://en.wikipedia.org/wiki/The_Prisoner&quot;&gt;(The Prisoner)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;German speaking countries got it right: They got computer science pegged.&lt;/p&gt;
&lt;p&gt;I love the start of this &lt;a href=&quot;http://groups.csail.mit.edu/mac/classes/6.001/abelson-sussman-lectures/&quot;&gt;set of lectures&lt;/a&gt; by Abelson and Sussman. In it, one of the guys casually strikes through &amp;#8220;Computer&amp;#8221;, then &amp;#8220;Science&amp;#8221;.&lt;/p&gt;
&lt;p&gt;Watch them and be enlightened. And they are so right.&lt;/p&gt;
&lt;p&gt;Why? Our work is not about computers, it&amp;#8217;s about information. Acquiring, analyzing, understanding, searching, offering: Information.&lt;/p&gt;
&lt;p&gt;In german, &lt;a href=&quot;http://de.wikipedia.org/wiki/Informatik&quot;&gt;Informatik&lt;/a&gt; is a combination of &amp;#8220;Information&amp;#8221; and &amp;#8220;Mathematik&amp;#8221;. That&amp;#8217;s calling a horse a horse!&lt;/p&gt;
&lt;p&gt;Actually, in english the term exists as well, &lt;a href=&quot;http://en.wikipedia.org/wiki/Informatics&quot;&gt;Informatics&lt;/a&gt; – but I&amp;#8217;ve never heard it used.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;that in information searching we sometimes forget we&amp;#8217;re engineers.&lt;/li&gt;
	&lt;li&gt;that there are many different types of search engines.&lt;/li&gt;
	&lt;li&gt;that we perhaps should be talking about &amp;#8220;informatics&amp;#8221; from now on.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;
&lt;p&gt;Comments and feedback, as usual, are appreciated.&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Picky 2.0</title>
   <link href="http://florianhanke.com/blog/2011/03/28/picky-two-dot-oh.html"/>
   <updated>2011-03-28T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/03/28/picky-two-dot-oh</id>
   <content type="html">&lt;p&gt;In my previous post, I talked about what bothers me in Picky&amp;#8217;s &lt;span class=&quot;caps&quot;&gt;API&lt;/span&gt;, and did a few 2.0 prerelease versions with the improvements.&lt;/p&gt;
&lt;p&gt;After quite a bit of feedback, Picky 2.0 is released! :)&lt;/p&gt;
&lt;p&gt;So, what&amp;#8217;s in it for you and what do you need to change in your 1.x version to use the spankingly new gem?&lt;/p&gt;
&lt;h2&gt;What has changed?&lt;/h2&gt;
&lt;p&gt;Only four things. 2.0&amp;#8217;s change list is short but sweet.&lt;/p&gt;
&lt;h3&gt;Index definitions&lt;/h3&gt;
&lt;p&gt;We&amp;#8217;ve added a nice new possibility to define categories on an index. The blocky initializer. So where you had&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;index = Index::Memory.new(:name, source)
index.define_category :a
index.define_category :b
index.define_category :c&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;you now can write&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;index = Index::Memory.new(:name, source) do
  category :a
  category :b
  category :c
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This helps keeping everything together a bit more tightly. Also, smoother skin by not having to type as much ;)&lt;/p&gt;
&lt;p&gt;The old style still works, but is totally shunned by veteran Pickiers. Be the hippest Pickier in town by using the blocky initializer style. You know you want it.&lt;/p&gt;
&lt;h3&gt;Query::Full/Live &amp;#8594; Search&lt;/h3&gt;
&lt;p&gt;The double definitions, &lt;code&gt;Query::Full&lt;/code&gt; and &lt;code&gt;Query::Live&lt;/code&gt; are no more. Good riddance!&lt;/p&gt;
&lt;p&gt;Instead, you simply use &lt;code&gt;Search&lt;/code&gt;. So instead of&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;class MyBeooootifulPickySearch &amp;lt; Application

  route %r{^/books/full} =&amp;gt; Query::Full.new(some_index),
        %r{^/books/live} =&amp;gt; Query::Live.new(some_index)

end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;you use&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;class MyBeooootifulPickySearch &amp;lt; Application

  route %r{^/books} =&amp;gt; Search.new(some_index)

end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It says &amp;#8220;Route this &lt;span class=&quot;caps&quot;&gt;URL&lt;/span&gt; to that search with these indexes and options&amp;#8221;.
Much more understandable and sexier! :)&lt;/p&gt;
&lt;p&gt;To discern whether it is a full (with result ids) or live (without result ids) search, you pass e.g. curl an &lt;code&gt;ids&lt;/code&gt; query parameter:&lt;/p&gt;
&lt;pre class=&quot;sh_bash&quot;&gt;&lt;code&gt;$ curl 'localhost:8080/books?query=meow&amp;amp;ids=15&amp;amp;offset=0'&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Defaults are 20 &lt;code&gt;ids&lt;/code&gt; and 0 &lt;code&gt;offset&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Similarity::Phonetic &amp;#8594; Similarity::DoubleMetaphone&lt;/h3&gt;
&lt;p&gt;We&amp;#8217;ve renamed &lt;code&gt;Similarity::Phonetic&lt;/code&gt; to &lt;code&gt;Similarity::DoubleMetaphone&lt;/code&gt;. It&amp;#8217;s still the same algorithm. See &lt;a href=&quot;http://en.wikipedia.org/wiki/Metaphone#Double_Metaphone&quot;&gt;the double metaphone&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Also, we&amp;#8217;ve added two default implementations, &lt;code&gt;Similarity::Metaphone&lt;/code&gt; and &lt;code&gt;Similarity::Soundex&lt;/code&gt; for your similarity pleasure :)&lt;/p&gt;
&lt;p&gt;Since Picky is normally used by programmers, &lt;code&gt;DoubleMetaphone&lt;/code&gt; is much clearer for what it actually does than &lt;code&gt;Phonetic&lt;/code&gt; – it&amp;#8217;s a bit of a mouthful, I admit.&lt;/p&gt;
&lt;p&gt;Picky will tell you if you still use the old &lt;code&gt;Phonetic&lt;/code&gt; definition in your &lt;code&gt;app/application.rb&lt;/code&gt;, so you don&amp;#8217;t need to learn this by heart.&lt;/p&gt;
&lt;h3&gt;Picky::Client::Full/Live (in a client) &amp;#8594; Picky::Client&lt;/h3&gt;
&lt;p&gt;The Picky client in your application needs a few changes. Only a single client is needed anymore. So instead of&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;FullBooksSearch = Picky::Client::Full.new ...
LiveBooksSearch = Picky::Client::Live.new ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;you use&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;BooksSearch = Picky::Client.new ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then in your e.g. controller actions passing what amount of ids you need&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;BooksSearch.search params[:query], :ids =&amp;gt; params[:ids], :offset =&amp;gt; params[:offset]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;or directly, using &lt;code&gt;:ids =&amp;gt; 20&lt;/code&gt; or however you like it.&lt;/p&gt;
&lt;h3&gt;Various&lt;/h3&gt;
&lt;p&gt;Leading up to 2.0, we&amp;#8217;ve removed the hashbangs in the JS client history, added &lt;code&gt;rake stats&lt;/code&gt; and &lt;code&gt;rake analyze&lt;/code&gt;. See more in the repo&amp;#8217;s top level &lt;code&gt;history.textile&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;that Picky is two-dot-oh-soooome!&lt;/li&gt;
	&lt;li&gt;what you&amp;#8217;d need to change to be 2.0 compatible.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;
&lt;p&gt;Btw, protip: Generate a client and server using &lt;code&gt;picky generate&lt;/code&gt; and see how everything is defined in 2.0 and compare.&lt;/p&gt;
&lt;p&gt;Comments and feedback, as usual, are appreciated.&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Picky's Coming of Age</title>
   <link href="http://florianhanke.com/blog/2011/03/16/pickys-adolescence.html"/>
   <updated>2011-03-16T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/03/16/pickys-adolescence</id>
   <content type="html">&lt;p&gt;I&amp;#8217;m gonna talk about what bothers me in Picky&amp;#8217;s current configuration and what I&amp;#8217;d like to propose for 2.0. Opinions or ideas for new &lt;span class=&quot;caps&quot;&gt;API&lt;/span&gt; features are very welcome!&lt;/p&gt;
&lt;h2&gt;A spot of bother&lt;/h2&gt;
&lt;p&gt;Since releasing 1.0, something&amp;#8217;s always bothered me about Picky&amp;#8217;s configuration.&lt;/p&gt;
&lt;p&gt;I used to think it&amp;#8217;s the abundance of class methods used in definining indexing, querying, or routing:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;class MyBeooootifulPickySearch &amp;lt; Application

  default_indexing removes_characters: /[^äöüa-zA-Z0-9\s\/\-\&quot;\&amp;amp;\.]/
  # etc.

end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I usually prefer instances on which I define things. In a nutshell, it&amp;#8217;s more easily testable. But this is not really the problem.&lt;/p&gt;
&lt;p&gt;So, what is it that is bothering me?&lt;/p&gt;
&lt;h2&gt;What is really bothering me&lt;/h2&gt;
&lt;p&gt;Take a look at how routing and queries are defined:&lt;/p&gt;
&lt;p&gt;Here, we&amp;#8217;re routing &lt;code&gt;/all/full&lt;/code&gt;, &lt;code&gt;/all/live&lt;/code&gt; to queries which includes three indexes, and &lt;code&gt;/contacts/full&lt;/code&gt;, &lt;code&gt;/contacts/live&lt;/code&gt; to queries with just the contacts index:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;route %r{\A/all/full\Z}      =&amp;gt; Query::Full.new(accounts_index, users_index, contacts_index),
      %r{\A/all/live\Z}      =&amp;gt; Query::Live.new(accounts_index, users_index, contacts_index),
      %r{\A/contacts/full\Z} =&amp;gt; Query::Full.new(contacts_index),
      %r{\A/contacts/live\Z} =&amp;gt; Query::Live.new(contacts_index)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the last sentence, I mention two things that are routed – why do I need double the number of route definitions?&lt;/p&gt;
&lt;h2&gt;Full and Live queries. Why?&lt;/h2&gt;
&lt;p&gt;Let me talk a little about the client why this is so.&lt;/p&gt;
&lt;p&gt;The Picky client does two different types of queries:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;A &amp;#8220;live&amp;#8221; query, which is sent when typing, to update the number of results.&lt;/li&gt;
	&lt;li&gt;A &amp;#8220;full&amp;#8221; query, which is sent when the user presses return or chooses an allocation.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A full query needs to be enriched with rendered results, e.g. with list entries.&lt;/p&gt;
&lt;p&gt;This means that full queries need to go through the webapp to be enriched (rendered results etc.) and the live queries can go directly to the server, as no enriching is needed.&lt;/p&gt;
&lt;p&gt;Also, live and full queries were once very different. I&amp;#8217;ve worked hard to unify them, and the only difference that still exists is that live queries don&amp;#8217;t contain the result ids, or more precise: They return 0 result ids, while full queries return by default 20 ids.&lt;/p&gt;
&lt;p&gt;The other reason was that I needed two different URLs to have &lt;a href=&quot;http://www.varnish-cache.org/&quot;&gt;Varnish&lt;/a&gt; route the live queries directly to the server (since the id count alone didn&amp;#8217;t need to be enriched by the webapp), and the full queries were routed through the webapp, like so:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/images/api1.png&quot; class=&quot;nonfloat&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Isn&amp;#8217;t it a bit overkill having to define two identical routes for two queries where just the amount of ids is different?&lt;/p&gt;
&lt;p&gt;Absolutely.&lt;/p&gt;
&lt;h2&gt;A better solution&lt;/h2&gt;
&lt;p&gt;What I&amp;#8217;d like to have is the following&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;route %r{\A/all\Z}      =&amp;gt; Query.new(accounts_index, users_index, contacts_index),
      %r{\A/contacts\Z} =&amp;gt; Query.new(contacts_index)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This would &lt;span class=&quot;caps&quot;&gt;DRY&lt;/span&gt; up the code immensely.&lt;/p&gt;
&lt;h2&gt;Problems with this solution&lt;/h2&gt;
&lt;p&gt;But now we&amp;#8217;re presented with two problems:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;How do we tell the server that we need 0, or 20 ids, and where?&lt;/li&gt;
	&lt;li&gt;How can I route the queries differently?&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Solutions to these problems&lt;/h2&gt;
&lt;p&gt;I suggest that the first problem is handled by a query parameter &lt;code&gt;ids&lt;/code&gt;. So a query through curl would look like this:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;curl localhost:8080/contacts?query=miller&amp;amp;ids=20&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Even if this means more typing, it is much more convenient and flexible to use. What I now can do is define default amounts in the JS client and in the webapp client (picky-client gem).&lt;/p&gt;
&lt;p&gt;The second problem is routing the queries differently. With the new way, you are much more flexible in this. Several solutions are possible. Say you have a Varnish:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If query param &lt;code&gt;ids&lt;/code&gt; is 0, we route directly to the server. If not, it is routed through the webapp.&lt;/li&gt;
	&lt;li&gt;Define two different URLs, route the live one right on to the server and send the other through the webapp.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Or without Varnish (or Nginx etc.):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Speed is not an issue? Route both through the webapp, and do different queries from there – one with 0 ids, one with 20.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Or any other way that suits you best.&lt;/p&gt;
&lt;h2&gt;Picky 2.0&lt;/h2&gt;
&lt;p&gt;Since this really irritates me, I&amp;#8217;ll start working on it &lt;span class=&quot;caps&quot;&gt;ASAP&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Most work is needed in the documentation – so if after the release, you see the old style anywhere, please tell me so.&lt;/p&gt;
&lt;p&gt;Yeah, Picky 2.0 – good times! :)&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;that Picky lives in a wet environment and needs some DRYing up.&lt;/li&gt;
	&lt;li&gt;that Picky 2.0 is around the corner.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;
&lt;p&gt;If you have some feedback on what else could be improved, comment away!&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Searching with Picky&#58; Rake Tasks</title>
   <link href="http://florianhanke.com/blog/2011/03/13/searching-with-picky-rake-tasks.html"/>
   <updated>2011-03-13T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/03/13/searching-with-picky-rake-tasks</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its workings. If you haven&amp;#8217;t tried it yet, do so in the &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;Getting Started&lt;/a&gt; section. It&amp;#8217;s quick and painless :)&lt;/p&gt;
&lt;p&gt;We&amp;#8217;ve all have used &lt;code&gt;rake index&lt;/code&gt; and &lt;code&gt;rake start&lt;/code&gt; to index and then start up a server. But did you know that Picky (and Rake, one of his best buddies) offer quite a few more?&lt;/p&gt;
&lt;p&gt;Let&amp;#8217;s do a quick &lt;code&gt;rake -T&lt;/code&gt;. What we get is:&lt;/p&gt;
&lt;pre class=&quot;sh_bash&quot;&gt;&lt;code&gt;$ rake -T
rake analyze                         # Analyze your indexes (needs rake index).
rake check:index                     # Checks the index files for files that are small or missing.
rake index                           # Generate the index (random order).
rake index:ordered                   # Takes a snapshot, indexes, and caches in order given.
rake index:randomly                  # Takes a snapshot, indexes, and caches in random order.
rake index:specific[index,category]  # Generates a specific index from index snapshots (category opt).
rake routes                          # Shows the available URL paths
rake spec                            # Run all specs in spec directory.
rake start                           # Start the server.
rake stats                           # Application summary.
rake stop                            # Stop the server.
rake try[text,index,category]        # Try the given text in the indexer/query (index/category opt).
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I will give you a quick overview over each of them, with the idea that you know what&amp;#8217;s there and can try them yourself if you need details.&lt;/p&gt;
&lt;p&gt;Before we begin, a note on the naming: I used to name rake tasks &lt;code&gt;rake subject:verb&lt;/code&gt;, but not in Picky, since Picky has a lot of single word tasks. So they&amp;#8217;re named &lt;code&gt;rake verb:subject&lt;/code&gt;, as subjects are usually not present.&lt;/p&gt;
&lt;p&gt;I&amp;#8217;ll start out with the fun ones.&lt;/p&gt;
&lt;h2&gt;rake try[text,index,category]&lt;/h2&gt;
&lt;p&gt;Suppose you send a few queries to Picky and you get empty results, even though you know that &amp;#8220;it must be in the indextubes&amp;#8221; aka &amp;#8220;Y U NO &lt;span class=&quot;caps&quot;&gt;FIND&lt;/span&gt;?&amp;#8221;.&lt;/p&gt;
&lt;p&gt;This is the task for you! It shows you how a text gets split up into tokens, in indexing and querying. Let me show you with an example project of mine:&lt;/p&gt;
&lt;pre class=&quot;sh_bash&quot;&gt;&lt;code&gt;$ rake 'try[flöre.hanke]'
...
&quot;flöre.hanke&quot; is saved in the index as             [:floerehanke]
&quot;flöre.hanke&quot; as a query will be preprocessed into [:&quot;floere.hanke&quot;]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I used single quotes to remind you that you might need these to escape special characters.&lt;/p&gt;
&lt;p&gt;So what we see is that if my specific Picky app encounters &lt;code&gt;flöre.hanke&lt;/code&gt;, it will index it as one word, remove &lt;code&gt;.&lt;/code&gt;
, and replace the umlaut &lt;code&gt;ö&lt;/code&gt;
with &lt;code&gt;oe&lt;/code&gt;, as per german rules.&lt;/p&gt;
&lt;p&gt;However, in a query, if someone searches for &lt;code&gt;flöre.hanke&lt;/code&gt;, my specific Picky app will not remove the &lt;code&gt;.&lt;/code&gt;
but use it as given (with the exception of the replaced &lt;code&gt;ö&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;So, in this case, nothing would be found.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;index&lt;/code&gt; and &lt;code&gt;category&lt;/code&gt; options let you specify with which index and category you&amp;#8217;d like to &lt;code&gt;try&lt;/code&gt; them.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rake try&lt;/code&gt; is your first line of defense against nasty configuration bugs.&lt;/p&gt;
&lt;p&gt;The interesting thing here is that often, the configurations for indexing and querying are similar.
The intelligence and beauty lies in &lt;em&gt;where they are not&lt;/em&gt;.&lt;/p&gt;
&lt;h2&gt;rake routes&lt;/h2&gt;
&lt;p&gt;Remember Rails? That huge framework that was eventually replaced by Sinatra? Same rake task: &lt;code&gt;rake routes&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;It blasts out all your routes and where they route to:
&lt;pre class=&quot;sh_bash&quot;&gt;&lt;code&gt;$ rake routes
...
Note: Anchored (✓) regexps are faster, e.g. /\A.*\Z/ or /^.*$/.
✓  \A/admin\Z      =&amp;gt; Suckerfish Live Interface (Use the picky-live gem to introspect)
✓  \A/books/full\Z =&amp;gt; Query::Full(books, isbn, weights: {[:author]=&amp;gt;6, [:title, :author]=&amp;gt;5})
✓  \A/books/live\Z =&amp;gt; Query::Live(books, isbn, weights: {[:author]=&amp;gt;6, [:title, :author]=&amp;gt;5})
&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;h2&gt;rake stats&lt;/h2&gt;
&lt;p&gt;Similar to Rails&amp;#8217; &lt;code&gt;rake stats&lt;/code&gt;, but with more steroids. Let me just show you an example:&lt;/p&gt;
&lt;pre class=&quot;sh_bash&quot;&gt;&lt;code&gt;$ rake stats
...
Application(s)
  Definition LOC:    81
  Indexes defined:    2

  BookSearch
    Indexing (default):
      Removes characters:        /[^äöüa-zA-Z0-9\s\/\-\&quot;\&amp;amp;\.]/
      Stopwords:                 /\b(und|and|the|or|on|of|in|is|to|from|as|at|an)\b/
      Splits text on:            /[\s\/\-\&quot;\&amp;amp;]/
      Removes chars after split: /[\.]/
      Normalizes words:          [[/\$(\w+)/i, &quot;\\1 dollars&quot;]]
      Rejects tokens?            Yes, see line 10 in app/application.rb
      Substitutes chars?         Yes, using CharacterSubstituters::WestEuropean.

    Querying (default):
      Removes characters:        /[^ïôåñëäöüa-zA-Z0-9\s\/\-\,\&amp;amp;\.\&quot;\~\*\:]/
      Stopwords:                 /\b(und|and|the|or|on|of|in|is|to|from|as|at|an)\b/
      Splits text on:            /[\s\/\-\,\&amp;amp;]+/
      Removes chars after split: //
      Normalizes words:          -
      Rejects tokens?            -
      Substitutes chars?         Yes, using CharacterSubstituters::WestEuropean.

    Indexes:
      books (Index::Memory):
        source:            Sources::DB(&quot;SELECT id, title, author, year FROM books&quot;, {:file=&amp;gt;&quot;app/db.yml&quot;})
        categories:        id, title, author, year
        result identifier: &quot;boooookies&quot;

      redis (Index::Redis):
        source:            Sources::CSV(title, author, isbn, year, publisher, subjects, {:file=&amp;gt;&quot;data/books.csv&quot;})
        categories:        title, author, year, publisher, subjects


    Routes:
      Note: Anchored (✓) regexps are faster, e.g. /\A.*\Z/ or /^.*$/.

      ✓  \A/admin\Z      =&amp;gt; Suckerfish Live Interface (Use the picky-live gem to introspect)
      ✓  \A/books/full\Z =&amp;gt; Query::Full(books, redis, weights: {[:author]=&amp;gt;6, [:title, :author]=&amp;gt;5)
      ✓  \A/books/live\Z =&amp;gt; Query::Live(books, redis, weights: {[:author]=&amp;gt;6, [:title, :author]=&amp;gt;5)
      ✓  \A/redis/full\Z =&amp;gt; Query::Full(redis, weights: {[:author]=&amp;gt;6, [:title, :author]=&amp;gt;5)
      ✓  \A/redis/live\Z =&amp;gt; Query::Live(redis, weights: {[:author]=&amp;gt;6, [:title, :author]=&amp;gt;5)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is cool, right? In one fell swoop you see who uses what stopwords,
which characters aren&amp;#8217;t removed, and how many &lt;span class=&quot;caps&quot;&gt;LOC&lt;/span&gt; your config file has. I love it.&lt;/p&gt;
&lt;p&gt;The routes are also available separately for just $9.99 … uh, I mean, as &lt;code&gt;rake routes&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;rake analyze&lt;/h2&gt;
&lt;p&gt;This task takes a look at your indexes and tells you a few statistics about them.
This is most likely to evolve into something more powerful with each iteration.&lt;/p&gt;
&lt;p&gt;For now, it gives you this:&lt;/p&gt;
&lt;pre class=&quot;sh_bash&quot;&gt;&lt;code&gt;$ rake analyze
...
Indexes analysis:
  books:id::
    exact:
      Index matches single characters.
      There's only one id per key – you'll only get single results.
      index key cardinality:                       540
      index key length range (avg):               1..3 (2.8)
      index ids per key length range (avg):       1..1 (1.0)
      weights range (avg):                    0.0..0.0 (0.0)
    partial*:
      Index matches single characters.
      index key cardinality:                       540
      index key length range (avg):               1..3 (2.8)
      index ids per key length range (avg):     1..111 (2.8)
      weights range (avg):                   0.0..4.71 (0.26)

  books:title::
    exact:
      Index matches single characters.
      index key cardinality:                      1681
      index key length range (avg):              1..19 (7.4)
      index ids per key length range (avg):      1..81 (1.9)
      weights range (avg):                   0.0..4.39 (0.33)
      similarity key length range (avg):          0..4 (3.58)
    partial*:
      Index matches single characters.
      index key cardinality:                      7010
      index key length range (avg):              1..19 (6.29)
      index ids per key length range (avg):     1..242 (3.08)
      weights range (avg):                   0.0..5.49 (0.52)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Most of it is probably gibberish. Picky tries to give you useful notes (in color, not visible above) about the indexes,
for example the &lt;span style=&quot;color:orange;&quot;&gt;Index matches single characters&lt;/span&gt; (when a single character already gets results) or
as a warning &lt;span style=&quot;color:red;&quot;&gt;There&amp;#8217;s only one id per key – you&amp;#8217;ll only get single results&lt;/span&gt;
(when you&amp;#8217;ll only get one result id per query – which might not be what you want).&lt;/p&gt;
&lt;h2&gt;rake index&amp;#8230;&lt;/h2&gt;
&lt;p&gt;Frankly, if you haven&amp;#8217;t seen &lt;code&gt;rake index&lt;/code&gt; yet, you haven&amp;#8217;t tried Picky yet. If this were a flow diagram, you&amp;#8217;d be sent back to the start ;)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rake index&lt;/code&gt; does just that. It indexes.&lt;/p&gt;
&lt;p&gt;You can tell it in what order to index them by using &lt;code&gt;rake index:ordered&lt;/code&gt; and &lt;code&gt;rake index:randomly&lt;/code&gt;, which will index the indexes either in the order they were defined or in a random fashion. Default is randomly, but if you&amp;#8217;re not happy with that, tell Picky explicitly.&lt;/p&gt;
&lt;p&gt;You can tell Picky to just index a single index, or even more specific, a single category inside a given index. Use &lt;code&gt;rake index:specific[books,title]&lt;/code&gt;.
It also tells you when an index or category is not there:
&lt;pre class=&quot;sh_bash&quot;&gt;&lt;code&gt;$ rake index:specific[books,isbn]
...
rake aborted!
Index category &quot;isbn&quot; not found. Possible categories: &quot;id&quot;, &quot;title&quot;, &quot;author&quot;, &quot;year&quot;.&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;h2&gt;rake check&amp;#8230;&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;rake check:index&lt;/code&gt; checks the indexes for suspiciously small or nonexistent indexes.&lt;/p&gt;
&lt;h2&gt;rake start/stop&lt;/h2&gt;
&lt;p&gt;One starts a Unicorn server, one stops it. I always forget which is which.&lt;/p&gt;
&lt;p&gt;It&amp;#8217;s not too webserver agnostic yet, but as soon as somebody complains, I will rewrite it to be so – if you&amp;#8217;re not faster with one of these beloved pull requests :)&lt;/p&gt;
&lt;h2&gt;rake spec&lt;/h2&gt;
&lt;p&gt;You will be surprised by this one: Runs the specs in the spec directory.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;that Picky does not just &lt;code&gt;rake index&lt;/code&gt; and &lt;code&gt;rake start&lt;/code&gt;.&lt;/li&gt;
	&lt;li&gt;that Picky gives you a few command line tools (apart from the web tools) to find bugs in your config.&lt;/li&gt;
	&lt;li&gt;that Picky is not just good for picking up girls in bars.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Searching with Picky&#58; Redis</title>
   <link href="http://florianhanke.com/blog/2011/03/02/searching-with-picky-redis.html"/>
   <updated>2011-03-02T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/03/02/searching-with-picky-redis</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its workings. If you haven&amp;#8217;t tried it yet, do so in the &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;Getting Started&lt;/a&gt; section. It&amp;#8217;s quick and painless :)&lt;/p&gt;
&lt;p&gt;This post will be a very short introduction on Redis index backends and Picky, and how to configure your indexes to run on Redis.&lt;/p&gt;
&lt;p&gt;I intended to do a massive writeup, but since all you do is change 6 characters &lt;code&gt;Memory&lt;/code&gt; into 5 different characters &lt;code&gt;Redis&lt;/code&gt; it just seemed like a massive overkill.&lt;/p&gt;
&lt;p&gt;I admit though that many massive writeups have been done on even smaller changes, like &amp;#8220;1.8&amp;#8221; &amp;#8594; &amp;#8220;1.9&amp;#8221; ;)&lt;/p&gt;
&lt;p&gt;Ok, so what am I talking about?&lt;/p&gt;
&lt;h2&gt;tl;dr&lt;/h2&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;a href=&quot;http://redis.io/&quot;&gt;Redis&lt;/a&gt; can now be used in Picky as an index backend.&lt;/li&gt;
	&lt;li&gt;In your config, do &lt;code&gt;Index::Memory.new&lt;/code&gt; &amp;#8594; &lt;code&gt;Index::Redis.new&lt;/code&gt; and you&amp;#8217;re set :)&lt;/li&gt;
	&lt;li&gt;Memory and Redis indexes cannot (yet) be mixed and matched.&lt;/li&gt;
	&lt;li&gt;In 1.5.0, Picky uses Redis database 15.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;What is Redis?&lt;/h2&gt;
&lt;p&gt;Redis is – taken from the website – an &amp;#8220;&lt;em&gt;open source, advanced key-value store&lt;/em&gt;&amp;#8221;. But this is not all. It also is a &amp;#8220;&lt;em&gt;data structure server&lt;/em&gt;&amp;#8221;. Check it out &lt;a href=&quot;http://redis.io/&quot;&gt;on its very nicely done website&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&amp;#8220;But we already have the massively fast in-memory backend. Why Redis?&amp;#8221;, you scream, indignantly.&lt;/p&gt;
&lt;h2&gt;Why Redis?&lt;/h2&gt;
&lt;p&gt;Granted, in-memory indexes in Picky are really fast. But they have a few drawbacks:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Relatively slow search engine startup, as the &lt;span class=&quot;caps&quot;&gt;JSON&lt;/span&gt; index files need to be loaded into memory. This is especially noticeable if the index is around 12 GB.&lt;/li&gt;
	&lt;li&gt;To restart Unicorn without a hitch you need double the space the in-memory index needs, since Unicorn starts up a second master in parallel to the old one.&lt;/li&gt;
	&lt;li&gt;They need to be reloaded to be updated (see last blog post).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I haven&amp;#8217;t had any problems with that, but I can see the problem. Hence, Redis.&lt;/p&gt;
&lt;h2&gt;How do you use Redis indexes?&lt;/h2&gt;
&lt;p&gt;Looking at the configuration that the scaffolding generates, you see that it uses an &lt;code&gt;Index::Memory&lt;/code&gt; called books:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;books_index = Index::Memory.new :books, Sources::CSV.new(:title, :author, file: 'app/library.csv')&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If you&amp;#8217;d like to use the Redis backend instead, you&amp;#8217;ll have to change &lt;code&gt;Memory&lt;/code&gt; into &lt;code&gt;Redis&lt;/code&gt;.&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;books_index = Index::Redis.new :books, Sources::CSV.new(:title, :author, file: 'app/library.csv')&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I know. Picky is hard on the typing hand ;)&lt;/p&gt;
&lt;p&gt;Uh. That&amp;#8217;s already it. Welcome Redis. Bye bye, Memory.&lt;/p&gt;
&lt;p&gt;What you have to do now is re-index and start Picky:&lt;/p&gt;
&lt;pre class=&quot;sh_bash&quot;&gt;&lt;code&gt;$ rake index
... indexing output ...
$ rake start&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Or, start Picky, re-index and search while it is indexing, to get some added fun value.&lt;/p&gt;
&lt;h2&gt;What is the impact of Redis indexes?&lt;/h2&gt;
&lt;p&gt;Compared to the in-memory index, what are the advantages and disadvantages?&lt;/p&gt;
&lt;p&gt;Advantages:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Faster startup time, especially with a large index.&lt;/li&gt;
	&lt;li&gt;Indexing as-you-search. (No index reloading)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Drawbacks:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Factors slower.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Caveats / Next Versions&lt;/h2&gt;
&lt;p&gt;The Redis backend implementation in Picky is not yet customizable. This means that:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;It uses Redis database 15.&lt;/li&gt;
	&lt;li&gt;Returned entry ids are always strings, even when they were integers going in. You&amp;#8217;ll have to convert them back.&lt;/li&gt;
	&lt;li&gt;Redis and Memory indexes cannot (yet) be mixed and matched. So this isn&amp;#8217;t possible: &lt;code&gt;Query::Full.new(redis_index, memory_index)&lt;/code&gt;. Picky will notify you if you try to do so, so no worries.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I am focusing on these points in the upcoming 1.5.* versions.&lt;/p&gt;
&lt;h2&gt;Outlook&lt;/h2&gt;
&lt;p&gt;One of the next blog posts will look at the performance differences between the Redis backend and the memory backend.&lt;/p&gt;
&lt;p&gt;I can already reveal that the memory backend will be faster. Surprise! ;) The question is: Is Redis so much slower as to be unbearable?&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Music, pregnant with suspense, fills the room: Dun dun &lt;span class=&quot;caps&quot;&gt;DUNNN&lt;/span&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;what Redis is.&lt;/li&gt;
	&lt;li&gt;that Picky offers two different index backends: In-Memory and Redis.&lt;/li&gt;
	&lt;li&gt;how you use/implement the Redis index backend in your search.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Searching with Picky&#58; Live&nbsp;reloading&nbsp;indexes</title>
   <link href="http://florianhanke.com/blog/2011/02/20/searching-with-picky-live-reloading-indexes.html"/>
   <updated>2011-02-20T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/02/20/searching-with-picky-live-reloading-indexes</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its workings. If you haven&amp;#8217;t tried it yet, do so in the &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;Getting Started&lt;/a&gt; section. It&amp;#8217;s quick and painless :)&lt;/p&gt;
&lt;p&gt;This post is on reloading indexes by way of signals. So, first let&amp;#8217;s talk a little about signals. Then, in the second half, I talk about reloading the memory index in Picky.&lt;/p&gt;
&lt;p&gt;Warp 9?&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;#signals&quot;&gt;Signals in Ruby&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;#oldhandler&quot;&gt;Still calling the old trap handler&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;#reloading&quot;&gt;Reloading the indexes&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;#exception&quot;&gt;Back when Ruby was mostly foxes and bacon&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;En-gage.&lt;/p&gt;
&lt;h2 id=&quot;signals&quot;&gt;Signals in Ruby&lt;/h2&gt;
&lt;p&gt;Signals are way of sending instructions to a running process. Here&amp;#8217;s a &lt;a href=&quot;http://www.ruby-doc.org/core/classes/Signal.html#M001253&quot;&gt;list of signals&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In Ruby you handle these signals by giving the &lt;a href=&quot;http://www.ruby-doc.org/core/classes/Signal.html#M001252&quot;&gt;Signal#trap&lt;/a&gt; method a handler block:&lt;/p&gt;
&lt;p&gt;What if I give it two? Let&amp;#8217;s try it.&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Signal.trap('USR1') { p &quot;hello&quot; }
Signal.trap('USR1') { p &quot;world&quot; }

# Print out the process PID such that it is easier
# to enter &quot;kill -USR1 the_printed_process_pid&quot;
#
puts Process.pid

# You have sixty seconds to defuse … err try this example.
#
sleep 60&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then, enter &lt;code&gt;kill -USR1 &amp;lt;the printed process pid&amp;gt;&lt;/code&gt; and see what happens.&lt;/p&gt;
&lt;p&gt;What happens is that the second block that prints &amp;#8220;world&amp;#8221; replaces the first one. So we see:&lt;/p&gt;
&lt;pre class=&quot;sh_bash&quot;&gt;&lt;code&gt;type here&amp;gt; ruby signals.rb 
77306
&quot;world&quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ruby throws the old block away. What if I don&amp;#8217;t want this?&lt;/p&gt;
&lt;h2 id=&quot;oldhandler&quot;&gt;Still calling the old trap handler&lt;/h2&gt;
&lt;p&gt;So, for example, in Unicorn, sending the &lt;code&gt;USR1&lt;/code&gt; signal handler reopens all logs. What if I want to do something else? If I just do&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Signal.trap('USR1') { something_else }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;the old handler will be gone.&lt;/p&gt;
&lt;p&gt;So, my assumption was that Ruby gives me the old handler when calling&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;old_handler = Signal.trap('USR1')&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Nope. Hurting the &lt;a href=&quot;http://de.wikipedia.org/wiki/Principle_of_Least_Surprise&quot;&gt;&lt;span class=&quot;caps&quot;&gt;POLS&lt;/span&gt;&lt;/a&gt; a little here. It only gives me the old handler when installing a new one.&lt;/p&gt;
&lt;p&gt;So what can you do? Use this &amp;#8220;trick&amp;#8221;:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;old_handler = Signal.trap('USR1') {}
Signal.trap('USR1') { something_else; old_handler.call }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So I install a bogus handler to get the old handler, then throw the bogus handler away, right away, and call the old handler in the new handler.&lt;/p&gt;
&lt;h2 id=&quot;reloading&quot;&gt;Reloading the indexes&lt;/h2&gt;
&lt;p&gt;Currently, Picky does not support realtime indexes. It also runs with memory-only indexes (a &lt;a href=&quot;http://redis.io/&quot;&gt;Redis&lt;/a&gt; index backend is in the works). So, while the Picky server is running, it does not by itself pick up the new indexes, even if you generate new index files by running &lt;code&gt;rake index&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Btw, did you ever try to call &lt;code&gt;rake -T&lt;/code&gt; while in your Picky server project?&lt;/p&gt;
&lt;p&gt;How can we reload the indexes?&lt;/p&gt;
&lt;p&gt;Quite easy, actually. Reloading the memory indexes is done by calling&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Indexes.reload&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That&amp;#8217;s it.&lt;/p&gt;
&lt;p&gt;How do we get the Picky server process to call &lt;code&gt;Indexes.reload&lt;/code&gt;?&lt;/p&gt;
&lt;p&gt;Now talking about all that signal handling pays off! :)&lt;/p&gt;
&lt;h3&gt;… in a non-forking web server.&lt;/h3&gt;
&lt;p&gt;When running Picky in a non-forking web server, in e.g. thin, in the file &lt;code&gt;app/application.rb&lt;/code&gt; we&amp;#8217;d call&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Signal.trap('USR1') { Indexes.reload }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and then in the Terminal, we run&lt;/p&gt;
&lt;pre class=&quot;sh_bash&quot;&gt;&lt;code&gt;type here&amp;gt; rake index
... (Picky indexes and writes new index files. Afterwards you tell the server to reload the indexes.)
type here&amp;gt; kill -USR1 your_picky_server_process_id&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You should see some output that the server has reloaded the indexes.&lt;/p&gt;
&lt;h3&gt;… in a forking web server.&lt;/h3&gt;
&lt;p&gt;Unicorn, for example. Picky&amp;#8217;s current web server of choice.&lt;/p&gt;
&lt;p&gt;Since Unicorn already defines &lt;code&gt;USR1&lt;/code&gt;, we use the trick we&amp;#8217;ve talked about above to not replace the unicorn handler (if you need it):&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;old_handler = Signal.trap('USR1') {}
Signal.trap('USR1') { Indexes.reload; old_handler.call }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(Doesn&amp;#8217;t have to be &lt;code&gt;USR1&lt;/code&gt;, btw)&lt;/p&gt;
&lt;p&gt;After indexing and sending the &lt;code&gt;USR1&lt;/code&gt; signal to the Unicorn master, we aren&amp;#8217;t finished. Since the indexes have only been reloaded in the master, while the children are still happily using the old indexes.&lt;/p&gt;
&lt;p&gt;Check out &lt;a href=&quot;http://unicorn.bogomips.org/SIGNALS.html&quot;&gt;this very helpful page about signals in Unicorn&lt;/a&gt;. If &lt;code&gt;preload_app&lt;/code&gt; is set to &lt;code&gt;false&lt;/code&gt; in the unicorn.ru, you can just send a &lt;code&gt;HUP&lt;/code&gt; signal to the master. It will then kill all children, and fork then. Finished.&lt;/p&gt;
&lt;p&gt;When using Unicorn, you may of course also use &lt;a href=&quot;http://unicorn.bogomips.org/SIGNALS.html&quot;&gt;the way Unicorn does it&lt;/a&gt;. See the instructions under &amp;#8220;Procedure to replace a running unicorn executable&amp;#8221;.&lt;/p&gt;
&lt;p&gt;Good stuff! Although this procedure uses around double the memory the Picky server uses normally, while the index reloading uses around 1.5 times the size of the largest sub-index (in a nutshell, a lot less than the Unicorn replacement technique).&lt;/p&gt;
&lt;h3&gt;… periodically.&lt;/h3&gt;
&lt;p&gt;What about reloading the indexes periodically?&lt;/p&gt;
&lt;p&gt;You could, of course, try to use a &lt;code&gt;Thread&lt;/code&gt;, trying to reload the indexes every X time units and monkey around with it (tell me if you are successful :) ). I wouldn&amp;#8217;t.&lt;/p&gt;
&lt;p&gt;I recommend to externally trigger &lt;code&gt;rake index&lt;/code&gt;, and then trigger reloads from outside using the mentioned signals.&lt;/p&gt;
&lt;h2 id=&quot;exception&quot;&gt;Btw, a fun thing with signals you should not do&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Back when Ruby was mostly foxes and bacons&lt;/em&gt;, I happened to type this:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;begin
  p Process.pid
  looong_running_method
rescue Exception =&amp;gt; e
  p &quot;Oh deary me!&quot;
  retry
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Note: I did not actually type &lt;code&gt;looong_running_method&lt;/code&gt; and &lt;code&gt;&quot;Oh deary me!&quot;&lt;/code&gt;, but you get the idea ;)&lt;/p&gt;
&lt;p&gt;The idea was that if the long running method fails, it&amp;#8217;d just retry running it.&lt;/p&gt;
&lt;p&gt;Sounds good, right? Try running it, and stop it with &lt;code&gt;Ctrl-C&lt;/code&gt;. The problem is the line &lt;code&gt;rescue Exception =&amp;gt; e&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Why? I soon found out that catching all &lt;code&gt;Exceptions&lt;/code&gt; is not a good idea if you&amp;#8217;d like stopping your program by way of &lt;code&gt;Ctrl-C&lt;/code&gt;, since &lt;code&gt;SignalException&lt;/code&gt; inherits from &lt;code&gt;Exception&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;p SignalException.ancestors # =&amp;gt; [SignalException, Exception, Object, Kernel, BasicObject]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Ctrl-C&lt;/code&gt; sends a &lt;code&gt;SIGINT&lt;/code&gt;, an &lt;code&gt;INT&lt;/code&gt; signal to your process. Internally, a &lt;code&gt;SignalException&lt;/code&gt; is raised, which is then caught by the &lt;code&gt;rescue&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;A &lt;code&gt;kill -9&lt;/code&gt; sends this process to Walhalla. The place where all programs go that have incurred a major learning experience on their writers.&lt;/p&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;how signals work&lt;/li&gt;
	&lt;li&gt;that reloading indexes in a running Picky server is easy&lt;/li&gt;
	&lt;li&gt;how you use signals to reload the server&lt;/li&gt;
	&lt;li&gt;how reloading works in different web servers&lt;/li&gt;
	&lt;li&gt;that reloading the indexes isn&amp;#8217;t without problems&lt;/li&gt;
	&lt;li&gt;that you need to be careful when catching exceptions&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new!&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>A better Rubygems search</title>
   <link href="http://florianhanke.com/blog/2011/02/13/a-better-rubygems-search.html"/>
   <updated>2011-02-13T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/02/13/a-better-rubygems-search</id>
   <content type="html">&lt;p&gt;Some time ago, &lt;a href=&quot;http://blog.absurd.li/&quot;&gt;Kaspar&lt;/a&gt; mentioned to me that it would be nice to have a &lt;em&gt;gem dependency search&lt;/em&gt;, i.e. where you could search in which gems a gem is used.&lt;/p&gt;
&lt;p&gt;I thought so too, so I wrote one :)
(and added some more features in the process)&lt;/p&gt;
&lt;p&gt;Take a look: &lt;a href=&quot;http://gemsearch.heroku.com/&quot;&gt;http://gemsearch.heroku.com/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;(Note, it might take &lt;a href=&quot;http://heroku.com&quot;&gt;Heroku&lt;/a&gt; some time to ramp up the server)&lt;/p&gt;
&lt;h2&gt;Current state&lt;/h2&gt;
&lt;p&gt;While the &lt;a href=&quot;http://rubygems.org/&quot;&gt;current search&lt;/a&gt; isn&amp;#8217;t bad, it is missing the possibility of searching for an &lt;strong&gt;author&lt;/strong&gt;, &lt;strong&gt;where&lt;/strong&gt; a gem is used, or which &lt;strong&gt;version&lt;/strong&gt; it has. Or any combination thereof, for that matter.&lt;/p&gt;
&lt;h2&gt;Building the search&lt;/h2&gt;
&lt;p&gt;I happened to have a &lt;a href=&quot;http://florianhanke.com/picky/&quot;&gt;fast &amp;amp; clever search engine&lt;/a&gt; lying around ;) so this is what I used.&lt;/p&gt;
&lt;p&gt;How do you go about building or configuring a search engine?&lt;/p&gt;
&lt;h3&gt;1. Look at what your goals are.&lt;/h3&gt;
&lt;p&gt;My goals seemed simple enough.&lt;/p&gt;
&lt;p&gt;Each gem should be findable under:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Its &lt;strong&gt;name&lt;/strong&gt; (&lt;a href=&quot;http://gemsearch.heroku.com/#/?q=heroku_addon&quot;&gt;Try it&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;Its &lt;strong&gt;version(s)&lt;/strong&gt;, entered like x.y.z, or part thereof, x, x., x.y, x.y. (&lt;a href=&quot;http://gemsearch.heroku.com/#/?q=1%2E2%2E&quot;&gt;try it&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;Its &lt;strong&gt;author&amp;#8217;s names&lt;/strong&gt;, or first/last names. Or parts thereof, like &amp;#8220;flo&amp;#8221; for florian (&lt;a href=&quot;http://gemsearch.heroku.com/#/?q=hanke+flo&quot;&gt;try it&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;The gems it is &lt;strong&gt;dependent&lt;/strong&gt; upon. universe-parsing depends on parslet, for example (&lt;a href=&quot;http://gemsearch.heroku.com/#/?q=needs%3Aparslet&quot;&gt;try it&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;The names, gem name and dependent gem name should be &lt;strong&gt;phonetically findable&lt;/strong&gt; (&lt;a href=&quot;http://gemsearch.heroku.com/#/?q=rspoc%7E&quot;&gt;try it&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;The authors too should be &lt;strong&gt;phonetically findable&lt;/strong&gt; – since who knows how to write &amp;#8220;Heinemeier&amp;#8221; (&lt;a href=&quot;http://gemsearch.heroku.com/#/?q=heynemeyer%7E&quot;&gt;try it&lt;/a&gt;)?&lt;/li&gt;
	&lt;li&gt;All should be findable without entering the whole thing, like &amp;#8220;1.0&amp;#8221;, or &amp;#8220;activesupp&amp;#8221; (&lt;a href=&quot;http://gemsearch.heroku.com/#/?q=activesupp&quot;&gt;try it&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;One should be able to specify what he is looking for by prefixing e.g. &amp;#8220;uses:&amp;#8221; in front of the search term (&lt;a href=&quot;http://gemsearch.heroku.com/#/?q=uses%3Apicky&quot;&gt;Try it&lt;/a&gt;). Or others, like &amp;#8220;dependency:&amp;#8221;, &amp;#8220;dependencies:&amp;#8221;, &amp;#8220;depends:&amp;#8221;, &amp;#8220;using:&amp;#8221;, &amp;#8220;uses:&amp;#8221;, &amp;#8220;use:&amp;#8221;, &amp;#8220;needs:&amp;#8221; (all possible).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I leave out the description for now, as it requires quite a bit of thinking and tinkering.&lt;/p&gt;
&lt;p&gt;With the goals defined&amp;#8230;&lt;/p&gt;
&lt;h3&gt;2. Look at the data.&lt;/h3&gt;
&lt;p&gt;I downloaded the &lt;a href=&quot;http://rubygems.org/Marshal.4.8.Z&quot;&gt;Marshal&lt;/a&gt; file, extracted the relevant data and restructured it into a readable &lt;span class=&quot;caps&quot;&gt;CSV&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Two potential problems I noticed:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Gem names are spaced using either an underscore _ or a hyphen -.&lt;/li&gt;
	&lt;li&gt;For the same name, there are sometimes up to three different encodings. Take the gems of &lt;a href=&quot;http://www.twitter.com/godfoca&quot;&gt;Nicolás Sanguinetti&lt;/a&gt; for example. &lt;a href=&quot;http://gemsearch.heroku.com/#/?q=nicolas+sanguinetti&quot;&gt;Try it&lt;/a&gt; and look at the author names.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Those were problematic. What does one do? Try to find an optimal solution.&lt;/p&gt;
&lt;h3&gt;3. Marry the goals and the data.&lt;/h3&gt;
&lt;p&gt;I decided not to tackle the display issues of the second point, encodings, but just the indexing issues. What I do is use &lt;a href=&quot;/2011/01/13/searching-with-picky-character-substituters.html&quot;&gt;character substitution&lt;/a&gt;, to make &amp;#8220;Nicolás&amp;#8221; findable under &amp;#8220;nicolas&amp;#8221;. This I do by saving the name as &amp;#8220;nicolas&amp;#8221; in the index, and also perform this character substitution on each search. &lt;a href=&quot;http://gemsearch.heroku.com/#/?q=nicol%C3%A1s+sanguinetti&quot;&gt;Try it with án áccent&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Deciding on what to with the gem names was a little harder. What is the problem?&lt;/p&gt;
&lt;p&gt;The problem is manyfold. For one, searchers should not need to know whether a gem was spaced with an underscore or a hyphen. Actually, I thought it best they be able to find it using a space. So the picky-live gem should be findable by typing &amp;#8220;picky live&amp;#8221; (&lt;a href=&quot;http://gemsearch.heroku.com/#/?q=picky+live&quot;&gt;Try it&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;However, if you then look for &amp;#8220;sinatra&amp;#8221;, the actual sinatra gem is not the first in the list. This is because I opted to go for an alphabetical ordering.&lt;/p&gt;
&lt;p&gt;However, if I need the user to enter the full name (like &amp;#8220;anthonymoralez-apn_on_rails&amp;#8221;), they might not find it at all.&lt;/p&gt;
&lt;p&gt;So, the way I did it now is have the user be able to use spaces when searching and trust people to depend on Picky&amp;#8217;s combinatorial nature. For example, if you look for sinatra and know that one of the owners is called Tomayko, you&amp;#8217;ll get to your answer directly: &lt;a href=&quot;http://gemsearch.heroku.com/#/?q=sinatra+tomayko&quot;&gt;Search for &amp;#8216;sinatra tomayko&amp;#8217;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Generally, the more you can help Picky, the more it will help you right back.&lt;/p&gt;
&lt;h3&gt;4. Have users try it and get feedback.&lt;/h3&gt;
&lt;p&gt;This is where you come in :)&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://gemsearch.heroku.com/&quot;&gt;Check it out&lt;/a&gt;, if you haven&amp;#8217;t yet and tell me what you think &lt;a href=&quot;http://www.twitter.com/hanke&quot;&gt;@hanke&lt;/a&gt;! Do you have ideas for improvement? (If yes, tell me which so I can improve it)&lt;/p&gt;
&lt;p&gt;How about we use this search on &lt;a href=&quot;http://rubygems.org&quot;&gt;rubygems.org&lt;/a&gt;? :)&lt;/p&gt;
&lt;h3&gt;A few technical Picky specifics.&lt;/h3&gt;
&lt;p&gt;A few Picky specifics for insiders:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;We have 4 data categories: &lt;code&gt;name, version, author, dependencies&lt;/code&gt;.&lt;/li&gt;
	&lt;li&gt;The partial search &amp;#8220;rail*&amp;#8221; is done using &lt;code&gt;Partial::Substring.new(from: 1)&lt;/code&gt;.&lt;/li&gt;
	&lt;li&gt;The similarity &amp;#8220;hallou~&amp;#8221; is done using: &lt;code&gt;Similarity::Phonetic.new(2)&lt;/code&gt;.&lt;/li&gt;
	&lt;li&gt;A singly occurring name will be weighted up a little: &lt;code&gt;:weights =&amp;gt; { [:name] =&amp;gt; +1 } }&lt;/code&gt;.&lt;/li&gt;
	&lt;li&gt;The author for example can be prefixed with: &lt;code&gt;qualifiers: [:author, :authors, :written, :writer, :by]&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Yes, currently I &lt;a href=&quot;http://www.isolani.co.uk/blog/javascript/BreakingTheWebWithHashBangs&quot;&gt;break the web with hashtags&lt;/a&gt; – I&amp;#8217;m rewriting it to use &lt;code&gt;pushState&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Thanks&lt;/h2&gt;
&lt;p&gt;Many thanks to &lt;a href=&quot;http://heroku.com&quot;&gt;Heroku&lt;/a&gt; for providing the infrastructure!&lt;/p&gt;
&lt;h2&gt;Conclusions&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;that there&amp;#8217;s a better way to search Rubygems&lt;/li&gt;
	&lt;li&gt;where you can go to try it&lt;/li&gt;
	&lt;li&gt;how you could go about creating a search&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Running Sinatra inside a Ruby Gem</title>
   <link href="http://florianhanke.com/blog/2011/02/02/running-sinatra-inside-a-gem.html"/>
   <updated>2011-02-02T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/02/02/running-sinatra-inside-a-gem</id>
   <content type="html">&lt;p&gt;&lt;img src=&quot;/blog/images/sinatra.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its workings. If you haven&amp;#8217;t tried it yet, do so in the &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;Getting Started&lt;/a&gt; section. It&amp;#8217;s quick and painless :)&lt;/p&gt;
&lt;p&gt;In this post I&amp;#8217;ll show how to have &lt;a href=&quot;http://www.sinatrarb.com/&quot;&gt;Sinatra&lt;/a&gt; run directly from inside a gem. And at the end, how Picky uses this for its advantage.&lt;/p&gt;
&lt;p&gt;Let&amp;#8217;s go singing in the gem!&lt;/p&gt;
&lt;h2&gt;The thing is…&lt;/h2&gt;
&lt;p&gt;What I wanted, was to add a nice statistics web interface to Picky.&lt;/p&gt;
&lt;p&gt;First I though about adding it to the server, but soon after (~1.2µs) decided that this was a silly idea.&lt;/p&gt;
&lt;p&gt;Picky is heavily designed around loosely connected elements in the server. I think this is even a better idea outside of a large component such as a server. So what I found myself thinking about – while showering – next was, to have a gem which generates a &lt;a href=&quot;http://www.sinatrarb.com/&quot;&gt;Sinatra&lt;/a&gt; application…&lt;/p&gt;
&lt;p&gt;Suddenly the room lit up and I spotted, scrawled on the wall in burning letters of blood:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;The wrong question.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I gave it not much thought, as it can get crazy in this part of Zürich. Then, while gorging myself on my beloved alphabet soup, and thinking about how to structure files in this web application exactly, the letters suddenly formed a sentence:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Dude the wrong, fucking question.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;(Soups can only spell &lt;em&gt;so&lt;/em&gt; well)&lt;/p&gt;
&lt;p&gt;I only got it a few hours later, while three swedish massage therapists kneaded my shoulders.&lt;/p&gt;
&lt;p&gt;In computer science, the answers aren&amp;#8217;t nearly as important as asking:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;…the right fucking question.&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;The right fucking question&lt;/h2&gt;
&lt;p&gt;The right question is:&lt;/p&gt;
&lt;p&gt;How do I fit a web application wholly in a gem, such that I can do a&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$ picky stats log/search.log&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;on any Picky logfile and it will parse it and show me a nice statistical representation of it in a browser without soiling the directory and everything else?&lt;/p&gt;
&lt;h2&gt;The right fucking tool for the job&lt;/h2&gt;
&lt;p&gt;That&amp;#8217;s &lt;a href=&quot;http://www.sinatrarb.com/&quot;&gt;Sinatra&lt;/a&gt; I&amp;#8217;m talking about. The great and &lt;strong&gt;extremely&lt;/strong&gt; easy to use Ruby &lt;span class=&quot;caps&quot;&gt;DSL&lt;/span&gt; for web applications.&lt;/p&gt;
&lt;p&gt;Give it a whirl if you haven&amp;#8217;t seen it!&lt;/p&gt;
&lt;h2&gt;How to do it&lt;/h2&gt;
&lt;p&gt;First, set up a gem structure – let&amp;#8217;s call the gem &amp;#8220;rain_sining&amp;#8221;. Then, inside it, set up the following structure:&lt;/p&gt;
&lt;pre class=&quot;sh_text&quot;&gt;&lt;code&gt;rain_singing
  /bin
  /lib
    /rain_singing
      /application   # &amp;lt;- the app is in here
        app.rb       # &amp;lt;- the webapp itself
        /images
        /javascripts
        /stylesheets
        /views
    rain_singing.rb
  rain_singing.gemspec
  /spec&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The &amp;#8220;hardest&amp;#8221; thing is getting the directories correctly set up.&lt;/p&gt;
&lt;p&gt;So what you do inside &lt;code&gt;app.rb&lt;/code&gt; is:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;require 'sinatra'
require 'haml' # if you use haml views

class SingingRain &amp;lt; Sinatra::Base

  set :static, true                             # set up static file routing
  set :public, File.expand_path('..', __FILE__) # set up the static dir (with images/js/css inside)
  
  set :views,  File.expand_path('../views', __FILE__) # set up the views dir
  set :haml, { :format =&amp;gt; :html5 }                    # if you use haml
  
  # Your &quot;actions&quot; go here…
  #
  get '/' do
    haml :'/index'
  end
  
end

# Run the app!
#
puts &quot;Hello, you're running your web app from a gem!&quot;
SingingRain.run!&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And that&amp;#8217;s already it for the app.&lt;/p&gt;
&lt;p&gt;Now, if you want to define a binary for the gem, put an executable &lt;code&gt;rain_singing&lt;/code&gt; file into &lt;code&gt;/bin&lt;/code&gt;. Into this file you&amp;#8217;d write:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;#!/usr/bin/env ruby
#
begin
  require 'rain_singing/application/app.rb'
rescue LoadError =&amp;gt; e
  require 'rubygems'
  path = File.expand_path '../../lib', __FILE__
  $:.unshift(path) if File.directory?(path) &amp;amp;&amp;amp; !$:.include?(path)
  require 'rain_singing/application/app.rb'
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then, we need to tell rubygems that this gem has an executable:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Gem::Specification.new do |s|
  
  ...
  
  s.executables = ['rain_singing']
  s.default_executable = 'rain_singing'
  
  ...
  
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After generating your gem with&lt;/p&gt;
&lt;pre class=&quot;sh_text&quot;&gt;&lt;code&gt;$ gem build rain_singing.gemspec&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and installing it with&lt;/p&gt;
&lt;pre class=&quot;sh_text&quot;&gt;&lt;code&gt;$ gem install rain_singing-1.0.0.gem&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;you are ready to run&lt;/p&gt;
&lt;pre class=&quot;sh_text&quot;&gt;&lt;code&gt;$ rain_singing
Hello, you're running your web app from a gem!&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Good stuff. Good stuff. Makes me want to sing in the rain.&lt;/p&gt;
&lt;h2&gt;In Picky&lt;/h2&gt;
&lt;p&gt;Picky uses this for two things.&lt;/p&gt;
&lt;p&gt;A statistics interface (&lt;code&gt;$ gem install picky-statistics&lt;/code&gt;), run&lt;/p&gt;
&lt;pre class=&quot;sh_text&quot;&gt;&lt;code&gt;$ picky stats path/to/your/search.log 1234&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;or the live interface to the running server (&lt;code&gt;$ gem install picky-live&lt;/code&gt;), run&lt;/p&gt;
&lt;pre class=&quot;sh_text&quot;&gt;&lt;code&gt;$ picky live localhost:8080/admin 1234&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You need to add &lt;code&gt;route %r{/admin} =&amp;gt; LiveParameters.new&lt;/code&gt; in the server to have it work. But then you get the interface &lt;a href=&quot;http://florianhanke.com/blog/2011/01/27/searching-with-picky-live-parameters-part-2.html&quot;&gt;described in this blog post&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Nice, eh?&lt;/p&gt;
&lt;h2&gt;Conclusions&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;that Sinatra rocks my noodles&lt;/li&gt;
	&lt;li&gt;that a Gem can contain a whole webapp without footprint&lt;/li&gt;
	&lt;li&gt;that Picky uses both for maximal profit!&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Parslet Intro</title>
   <link href="http://florianhanke.com/blog/2011/02/01/parslet-intro.html"/>
   <updated>2011-02-01T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/02/01/parslet-intro</id>
   <content type="html">&lt;p&gt;Tonight I wanted to take some time off from Picky to write about &lt;a href=&quot;http://kschiess.github.com/parslet/&quot;&gt;Parslet&lt;/a&gt;, a parser construction library by my dear friend &lt;a href=&quot;http://www.absurd.li/&quot;&gt;Kaspar&amp;nbsp;Schiess&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;tl;dr&lt;/h2&gt;
&lt;ol&gt;
	&lt;li&gt;Parslet is great.&lt;/li&gt;
	&lt;li&gt;&lt;code&gt;gem install parslet&lt;/code&gt;&lt;/li&gt;
	&lt;li&gt;Look at &lt;a href=&quot;https://github.com/kschiess/parslet/tree/master/example&quot;&gt;any of the examples&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;Try, learn, try again, profit!&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;What is it?&lt;/h2&gt;
&lt;p&gt;In Kaspar&amp;#8217;s words: &amp;#8220;A small Ruby library for constructing parsers in the &lt;a href=&quot;http://en.wikipedia.org/wiki/Parsing_expression_grammar&quot;&gt;&lt;span class=&quot;caps&quot;&gt;PEG&lt;/span&gt;&lt;/a&gt; (Parsing Expression Grammar) fashion&amp;#8221;.&lt;/p&gt;
&lt;p&gt;A parser is used to transform text data into a semantically meaningful structure by injecting information based on assumptions on the text&amp;#8217;s structure. For example, &lt;code&gt;&quot;Hello, Florian!&quot;&lt;/code&gt; could be parsed into something like: &lt;code&gt;[sentence: [greeting:hello, separation:comma, name:florian, mark:exclamation]]&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;It&amp;#8217;s probably best if you just &lt;a href=&quot;http://kschiess.github.com/parslet/get-started.html&quot;&gt;tried it for yourself&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Are there other parser constructors?&lt;/h2&gt;
&lt;p&gt;Yes, &lt;a href=&quot;https://github.com/mjijackson/citrus&quot;&gt;Citrus&lt;/a&gt; and &lt;a href=&quot;http://treetop.rubyforge.org/&quot;&gt;Treetop&lt;/a&gt;. But let&amp;#8217;s be frank here. Parslet eats these for breakfast in terms of ease of use and power, in my humble and almost unbiased opinion. Let me explain why.&lt;/p&gt;
&lt;h2&gt;Why is it so powerful and easy?&lt;/h2&gt;
&lt;p&gt;On the main page, Kaspar notes that Parslet is especially easy by &amp;#8220;providing the best error reporting&amp;#8221; and &amp;#8220;not generating reams of code for you to debug&amp;#8221;.&lt;/p&gt;
&lt;p&gt;While both are certainly true, and I do not disagree, but I don&amp;#8217;t think that that is what makes Parslet so easy or powerful. Surely easi-&lt;em&gt;er&lt;/em&gt;, but the main reason I love it is that it harnesses the power of Ruby.&lt;/p&gt;
&lt;p&gt;The second reason I consider it so great is that it split into a &lt;em&gt;parser&lt;/em&gt; and a &lt;em&gt;transformer&lt;/em&gt; step, with an intermediate syntax tree that is entirely in Ruby basic atoms, like hashes and arrays.&lt;/p&gt;
&lt;p&gt;Why is this cool? To repeat my example, above:
The parser would first parse &lt;code&gt;&quot;Hello, Florian!&quot;&lt;/code&gt; into &lt;code&gt;[sentence: [greeting:hello, separation:comma, name:florian, mark:exclamation]]&lt;/code&gt; and then, for example,
a &lt;code&gt;FrenchTransformer&lt;/code&gt; could be used to transform this into: &lt;code&gt;Bonjour, Florian!&lt;/code&gt;, the french representation of the english input sentence. So first we get an intermediate semantic expression that we can then transform into something else. And there can be a lot of transformers starting from where the parser ended. Thinking about a &lt;code&gt;SwedishTransformer&lt;/code&gt; or an &lt;code&gt;ItalianTransformer&lt;/code&gt;? Me too. &amp;#8220;Optimus Primo, transformate! Ciao!&amp;#8221;&lt;/p&gt;
&lt;p&gt;Or a chain of transformers that first take the intermediate tree and morph it into a different intermediate tree. The possibilities are endless.&lt;/p&gt;
&lt;h2&gt;Simple Example&lt;/h2&gt;
&lt;p&gt;Let&amp;#8217;s consider a simple example. It is a subpart of the &lt;a href=&quot;http://www.ruby-doc.org/stdlib/libdoc/erb/rdoc/classes/ERB.html&quot;&gt;&lt;span class=&quot;caps&quot;&gt;ERB&lt;/span&gt;&lt;/a&gt; &lt;a href=&quot;https://github.com/kschiess/parslet/blob/master/example/erb.rb&quot;&gt;parser&amp;nbsp;and&amp;nbsp;transformer&lt;/a&gt;  that I wrote. &lt;span class=&quot;caps&quot;&gt;ERB&lt;/span&gt; is a Ruby templating language by Seki Masatoshi.&lt;/p&gt;
&lt;p&gt;We&amp;#8217;ll look at the whole thing later on.&lt;/p&gt;
&lt;p&gt;A simple &lt;span class=&quot;caps&quot;&gt;ERB&lt;/span&gt; example would be &lt;span class=&quot;caps&quot;&gt;ERB&lt;/span&gt; with a Ruby expression inside:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Hello, my name is&amp;lt;%= name &amp;gt;!&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;What we get out of the parser is the parts that are text, and the parts that are ruby code.
So with parslet we&amp;#8217;d write this:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;require 'parslet'

class ErbParser &amp;lt; Parslet::Parser
  
  rule(:ruby_expression) { (str('%&amp;gt;').absnt? &amp;gt;&amp;gt; any).repeat.as(:ruby) }
  rule(:erb_with_tags) { str('&amp;lt;%=') &amp;gt;&amp;gt; ruby_expression &amp;gt;&amp;gt; str('%&amp;gt;') }
  
  rule(:text) { (str('&amp;lt;%=').absnt? &amp;gt;&amp;gt; any).repeat(1).as(:text) }
  
  rule(:text_with_ruby_expressions) { (text | erb_with_tags).repeat }
  root(:text_with_ruby_expressions)
end

p ErbParser.new.parse(&quot;Hello, my name is&amp;lt;%= name %&amp;gt;!&quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Just run it :) What you get is a nice semantic tree:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;[{:text=&amp;gt;&quot;Hello, my name is&quot;}, {:ruby=&amp;gt;&quot; name &quot;}, {:text=&amp;gt;&quot;!&quot;}]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let me go through it in steps. I&amp;#8217;ve found out that it is easiest for me to go top-down to define a parser. I hope this suits you too.&lt;/p&gt;
&lt;p&gt;We define the starting point, aka the &lt;code&gt;root&lt;/code&gt; of the parser with the &lt;code&gt;root&lt;/code&gt; method:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;root(:text_with_ruby_expressions)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This just says, start with the &lt;code&gt;rule(:text_with_ruby_expressions)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;So, now what we know about our simple-&lt;span class=&quot;caps&quot;&gt;ERB&lt;/span&gt; language is that it is basically a sequence of text and ruby expressions, repeating. So let&amp;#8217;s define that:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;rule(:text_with_ruby_expressions) { (text | erb_with_tags).repeat }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So either we have text OR (&lt;code&gt;|&lt;/code&gt;) a ruby expression. And we have that in a repeating fashion. Just as the rule says.&lt;/p&gt;
&lt;p&gt;Let&amp;#8217;s look at the text rule we just used:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;rule(:text) { (str('&amp;lt;%=').absnt? &amp;gt;&amp;gt; any).repeat(1).as(:text) }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This means: As long as you don&amp;#8217;t encounter a &lt;span class=&quot;caps&quot;&gt;ERB&lt;/span&gt; start tag (&lt;code&gt;&amp;lt;%=&lt;/code&gt;), keep taking everything as text. This will stop if it encounters a &lt;code&gt;&amp;lt;%=&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;At which point Parslet will try to apply the other rule:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;rule(:erb_with_tags) { str('&amp;lt;%=') &amp;gt;&amp;gt; ruby_expression &amp;gt;&amp;gt; str('%&amp;gt;') }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This rule just matches anything with erb start &lt;code&gt;&amp;lt;%=&lt;/code&gt; and end tags &lt;code&gt;%&amp;gt;&lt;/code&gt; around it, with a ruby expression inside.&lt;/p&gt;
&lt;p&gt;The ruby expression is simple:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;rule(:ruby_expression) { (str('%&amp;gt;').absnt? &amp;gt;&amp;gt; any).repeat.as(:ruby) }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We know this already: As long as you don&amp;#8217;t encounter an &lt;span class=&quot;caps&quot;&gt;ERB&lt;/span&gt; end tag, keep consuming as ruby code.&lt;/p&gt;
&lt;p&gt;Got it?&lt;/p&gt;
&lt;p&gt;Again, if you run it, you get:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;[{:text=&amp;gt;&quot;Hello, my name is&quot;}, {:ruby=&amp;gt;&quot; name &quot;}, {:text=&amp;gt;&quot;!&quot;}]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Niiice.&lt;/p&gt;
&lt;p&gt;Let&amp;#8217;s not think about the transform step for a second and look at some of the good shit.&lt;/p&gt;
&lt;h2&gt;Goodies that will blow your mind.&lt;/h2&gt;
&lt;p&gt;Parslet doesn&amp;#8217;t force you to use a class. It&amp;#8217;s totally ok to just do this:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;include Parslet
parser = (str('Hello') | str('Hi')).as(:greeting)
p parser.parse('Hello')&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In Parslet, you can run the parser with a subset of its rules:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;p ErbParser.new.erb_with_tags.parse(&quot;&amp;lt;%= name %&amp;gt;&quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;while&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;p ErbParser.new.erb_with_tags.parse(&quot;Hello, &amp;lt;%= name %&amp;gt;!&quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;would fail since the &lt;code&gt;erb_with_tags&lt;/code&gt; rule just covers text which starts with &lt;code&gt;&amp;lt;%=&lt;/code&gt; and ends with &lt;code&gt;%&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Running a &lt;code&gt;parse&lt;/code&gt; on a subrule works because a parser is composed of &lt;em&gt;Parslets&lt;/em&gt;, or parser atoms, hence the name. &lt;code&gt;str('hello')&lt;/code&gt; is one of these atoms, and so is a sequence of atoms, like &lt;code&gt;str('no') &amp;gt;&amp;gt; str('kidding')&lt;/code&gt;. And you can do a parse directly with one of these, if you want, &lt;code&gt;(str('Hello') | str('Hi')).parse('Hello')&lt;/code&gt; as we have seen before.&lt;/p&gt;
&lt;p&gt;Did I say it&amp;#8217;s pure Ruby? Why, yes! Let&amp;#8217;s harness the power of Ruby, and combine it with the power of Parslet parser atoms.&lt;/p&gt;
&lt;p&gt;I need a parser that is case insensitive regarding the string.&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;def case_insensitive string
  chars = string.split //
  chars.inject(str('')) do |parslet, char|
    parslet &amp;gt;&amp;gt; match(&quot;[#{char.downcase}|#{char.upcase}]&quot;)
  end
end

p case_insensitive('hello').parse('HeLLo')&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;What it does is generate this:
&lt;code&gt;match([h|H]) &amp;gt;&amp;gt; match([e|E]) &amp;gt;&amp;gt; match([l|L]) &amp;gt;&amp;gt; match([l|L]) &amp;gt;&amp;gt; match([o|O])&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This returns me a case insensitive parser that I can directly use to parse the &lt;code&gt;HeLLo&lt;/code&gt;. Or why not combine it with other parslets?&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;p (case_insensitive('hello') &amp;gt;&amp;gt; str(' ') &amp;gt;&amp;gt; str('Florian')).parse('HeLLo Florian')&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Transforming&lt;/h2&gt;
&lt;p&gt;Can you take a quick look at the &lt;a href=&quot;https://github.com/kschiess/parslet/blob/master/example/erb.rb&quot;&gt;&lt;span class=&quot;caps&quot;&gt;ERB&lt;/span&gt; parser&lt;/a&gt;, copy it into a script and give it a go?&lt;/p&gt;
&lt;p&gt;As you can see, it&amp;#8217;s not just able to parse text and ruby expressions (&lt;code&gt;&amp;lt;%= ruby expression %&amp;gt;&lt;/code&gt;), but also comments (&lt;code&gt;&amp;lt;%# comment %&amp;gt;&lt;/code&gt;) and normal ruby code (&lt;code&gt;&amp;lt;% ruby %&amp;gt;&lt;/code&gt;) that both will not be inserted into the rendered text.&lt;/p&gt;
&lt;p&gt;Now we&amp;#8217;ll have a look at the transformer that will spit out rendered text:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;evaluator = Parslet::Transform.new do
  
  erb_binding = binding
  
  rule(:code =&amp;gt; { :ruby =&amp;gt; simple(:ruby) }) { eval(ruby, erb_binding); '' }  
  rule(:expression =&amp;gt; { :ruby =&amp;gt; simple(:ruby) }) { eval(ruby, erb_binding) }
  rule(:comment =&amp;gt; { :ruby =&amp;gt; simple(:ruby) }) { '' }
  
  rule(:text =&amp;gt; simple(:text)) { text }
  rule(:text =&amp;gt; sequence(:texts)) { texts.join }
  
end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ignore for now the part where bindings are used.&lt;/p&gt;
&lt;p&gt;A transformer consists of a number of rules. And a rule consists of a part that recognizes structure in the semantic tree, and a block which tells the transformer what to do with the recognized thing. Got it? So this rule,&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;rule(:text =&amp;gt; sequence(:texts)) { texts.join }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;recognizes hashes that look like &lt;code&gt;:text =&amp;gt; sequence(:texts)&lt;/code&gt;, sequences of things that are denoted &lt;code&gt;as&lt;/code&gt; text. The identifier &lt;code&gt;:texts&lt;/code&gt; is used in the block where we tell the transformer what to do: &lt;code&gt;{ texts.join }&lt;/code&gt;. So what we do is simple, we just join a sequence of texts together.&lt;/p&gt;
&lt;p&gt;Another rule, the comment rule,&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;rule(:comment =&amp;gt; { :ruby =&amp;gt; simple(:ruby) }) { '' }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;will return just nothing.&lt;/p&gt;
&lt;p&gt;Now, if we want to parse and transform something like this:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;The &amp;lt;% a = 2 %&amp;gt;not printed result of &quot;a = 2&quot;.
The &amp;lt;%# a = 1 %&amp;gt;not printed non-evaluated comment &quot;a = 1&quot;, see the value of a below.
The &amp;lt;%= 'nicely' %&amp;gt; printed result.
The &amp;lt;% b = 3 %&amp;gt;value of a is &amp;lt;%= a %&amp;gt;, and b is &amp;lt;%= b %&amp;gt;.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It gets a little more complicated. If you look at line 1, you see that &lt;code&gt;a&lt;/code&gt; is given a value of &lt;code&gt;2&lt;/code&gt;. And then we will use that value in line 4, where we put the result of &lt;code&gt;2&lt;/code&gt; into the rendered template. Have you tried it? No? Run it and see :)&lt;/p&gt;
&lt;h2&gt;Remembering State&lt;/h2&gt;
&lt;p&gt;If you want the transformer rules to remember values in between transformations – like the &lt;code&gt;a&lt;/code&gt; that is set to &lt;code&gt;2&lt;/code&gt;, above, you&amp;#8217;ll need state of some sort.&lt;/p&gt;
&lt;p&gt;I can show you the way I did it with the &lt;span class=&quot;caps&quot;&gt;ERB&lt;/span&gt; transformer. I&amp;#8217;m sure you can think of many others that are perhaps safer, more powerful, or simply cleaner. But for now, we&amp;#8217;ll have a look at this:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;evaluator = Parslet::Transform.new do
  
  erb_binding = binding
  
  rule(:code =&amp;gt; { :ruby =&amp;gt; simple(:ruby) }) { eval(ruby, erb_binding); '' }
  
  ...

end&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;What happens here?
First, I assign the binding of the block to &lt;code&gt;erb_binding&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;erb_binding = binding&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is the object where we will safe the state.&lt;/p&gt;
&lt;p&gt;It&amp;#8217;s a good thing for me that the &lt;code&gt;rule&lt;/code&gt; method uses a block to define what to do when encountering a rule. Why? Well, since it is a block, the local variable &lt;code&gt;erb_binding&lt;/code&gt; is bound in the context of the block, which means that I have easy access to it in &lt;code&gt;{ eval(ruby, erb_binding); '' }&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;So what I do with&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;eval(ruby, erb_binding); ''&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;is: Evaluate the code piece that I get in the variable ruby, and evaluate it with the binding I have saved. Then, I return an empty string since &lt;code&gt;&amp;lt;% ruby code %&amp;gt;&lt;/code&gt; should not write anything into the resulting rendered template.&lt;/p&gt;
&lt;p&gt;Not so in the expression:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;rule(:expression =&amp;gt; { :ruby =&amp;gt; simple(:ruby) }) { eval(ruby, erb_binding) }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here I return whatever the evaluation returned to be inserted into the rendered result.&lt;/p&gt;
&lt;p&gt;Isn&amp;#8217;t it nice? And between parser and transformer I was able to look at my nice semantic tree, to check that everything is a-ok.&lt;/p&gt;
&lt;p&gt;Writing tests, as everything is in Ruby, is a breeze, as you can imagine!&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;My personal conclusion is that this thing is here to stay.&lt;/p&gt;
&lt;p&gt;Not only is it easy to use, but you have the full power of Ruby available to write parsers, comfortably.&lt;/p&gt;
&lt;p&gt;It already has garnered the attention of quite a few excellent Rubyists – the hard core of parslet users – which hang out at the #parslet &lt;span class=&quot;caps&quot;&gt;IRC&lt;/span&gt; channel.&lt;/p&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;that Parslet harnishes Ruby&amp;#8217;s powers for success and profit.&lt;/li&gt;
	&lt;li&gt;that it offers a parser constructor &lt;span class=&quot;caps&quot;&gt;AND&lt;/span&gt; a transformer constructor, which is a good thing.&lt;/li&gt;
	&lt;li&gt;that trying it yourself is fun and a piece of cake.&lt;/li&gt;
	&lt;li&gt;And: That using bindings is crazy fun when used at the right place :)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Searching with Picky&#58; Live Parameters Part 2</title>
   <link href="http://florianhanke.com/blog/2011/01/27/searching-with-picky-live-parameters-part-2.html"/>
   <updated>2011-01-27T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/01/27/searching-with-picky-live-parameters-part-2</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its workings. If you haven&amp;#8217;t tried it yet, do so in the &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;Getting Started&lt;/a&gt; section. It&amp;#8217;s quick and painless :)&lt;/p&gt;
&lt;p&gt;This is the second part of the Live Parameters blog post that deals with the problem of hot replacing a configuration of a search server like Picky running in a multiprocessing server like &lt;a href=&quot;http://unicorn.bogomips.org/&quot;&gt;unicorn&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;tl;dr&lt;/h2&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;code&gt;gem install picky-live&lt;/code&gt;&lt;/li&gt;
	&lt;li&gt;Server: In &lt;code&gt;app/application.rb&lt;/code&gt;, insert &lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;route %r{\A/admin\Z} =&amp;gt; LiveParameters.new&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
	&lt;li&gt;Enter &lt;code&gt;picky live&lt;/code&gt; on the command line.&lt;/li&gt;
	&lt;li&gt;Open &lt;a href=&quot;http://localhost:4568/&quot;&gt;The Suckerfish Interface&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;Have fun!&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;What was the problem, again?&lt;/h2&gt;
&lt;p&gt;The goal is that we want to update Picky&amp;#8217;s config while it is answering search requests.&lt;/p&gt;
&lt;p&gt;The problem is that we need to update the config in the master process, but most multiprocessing servers don&amp;#8217;t allow easy access. And it&amp;#8217;s good like that.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/images/suckerfish2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;What I&amp;#8217;d like to do is provide access for a suckerfish. But since it isn&amp;#8217;t easy or a good idea to open direct access to the parent, the suckerfish must go through the child.&lt;/p&gt;
&lt;p&gt;The child would accept data incoming from the suckerfish, process it and tell the parent what to change.&lt;/p&gt;
&lt;p&gt;So what we&amp;#8217;d need is for the child to be able to write the parent. It&amp;#8217;s actually quite easy to do in Ruby. But how?&lt;/p&gt;
&lt;h2&gt;The simplest way to write your parents.&lt;/h2&gt;
&lt;p&gt;… apart from picking up a pen once in a while? Your mother didn&amp;#8217;t spend 20 hours of her life in labor just for fun, you know!&lt;/p&gt;
&lt;p&gt;Heh.&lt;/p&gt;
&lt;p&gt;First, you open an &lt;a href=&quot;http://ruby.runpaint.org/io#pipes&quot;&gt;IO.pipe&lt;/a&gt;. Then, in the &lt;code&gt;fork&lt;/code&gt; (the child), you &lt;code&gt;close&lt;/code&gt; off the &amp;#8220;child&amp;#8221; and then you are ready to &lt;code&gt;write&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In the parent, you do the opposite, and call &lt;code&gt;gets&lt;/code&gt; (for example) then wait for a message from the child.&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;child, parent = IO.pipe

fork do
  # In child.
  #
  child.close
  puts &quot;#{Process.pid}: I'll write soon.&quot;
  parent.write &quot;Hello from child!&quot;
end

# In parent.
#
parent.close
message = child.gets '!'
puts &quot;#{Process.pid}: #{message}&quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It&amp;#8217;s copy-and-try!&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Process.pid&lt;/code&gt; returns the current process id, which is different in the child and the parent, as you can see after trying the example.
In the parent, the &lt;code&gt;child.gets&lt;/code&gt; with a parameter will read up until having received that string, then return whatever has been read so far.&lt;/p&gt;
&lt;p&gt;I always look at child and server as if the child was a perfect copy of the parent. And anything you change in the child won&amp;#8217;t affect the parent. But if you change something in the parent, it will affect all future children.&lt;/p&gt;
&lt;h2&gt;How Picky does it&lt;/h2&gt;
&lt;p&gt;Five steps:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The Picky child receives the config update request.&lt;/li&gt;
	&lt;li&gt;It tries to update its config (more on that below).&lt;/li&gt;
	&lt;li&gt;If successful, it tells the parent. If not, it kills itself, and tells Suckerfish which config was wrong.&lt;/li&gt;
	&lt;li&gt;The parent, on receiving the message, updates itself and kills off all other children (more on that below).&lt;/li&gt;
	&lt;li&gt;The child will answer Suckerfish with the current configuration.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The messaging is basically the same as above, but a bit more elaborate in Picky, since:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Picky doesn&amp;#8217;t have control over the forking.
This means Picky doesn&amp;#8217;t know when to close the &lt;code&gt;child&lt;/code&gt;, which is why on each call received on the &lt;span class=&quot;caps&quot;&gt;API&lt;/span&gt;, we just do a &lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;@child.close unless @child.closed?&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
	&lt;li&gt;The server inside which Picky is running will fork off the parent multiple times, and not just at the beginning.
So, if the parent would do a &lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;@parent.close&lt;/code&gt;&lt;/pre&gt; as in the example, then yes, it would work fine. Up until the next time a child is forked. What happens when a child is forked?
The connection to the parent would already have been closed off by the parent itself, and the child would be unable to &lt;code&gt;write&lt;/code&gt; on it. Solution? I just leave it open, since the parent doesn&amp;#8217;t need to talk to the child.
(Ensuring years of therapy for the child)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;How does Picky ensure there will be no problems in the parent process?&lt;/h2&gt;
&lt;p&gt;What would happen if the Suckerfish had direct access to the master&amp;#8217;s configuration?&lt;/p&gt;
&lt;p&gt;We assume that the child is a close to perfect copy of the parent process. So what we do is try updating the configuration in the child first.&lt;/p&gt;
&lt;p&gt;If that works, we can assume that in the parent, it will work too (no malformed configuration input). So we just send the parent the data and the parent will use the exact same method as the child to update itself.&lt;/p&gt;
&lt;p&gt;Now we have the problem that there are still children hanging around with the old config. So what the parent process – any good parent ;) – does is kill all of these. The one giving it the ok config is spared, since it has the new config already. After that, new children are forked with the correct config.&lt;/p&gt;
&lt;p&gt;What happens if the config is malformed? The child that accepted the suckerfish request needs to die, since its config might now be malformed. So what it does is prepare for an honorable &lt;em&gt;Harakiri&lt;/em&gt;, tell the Suckerfish what is wrong, and perform a horizontal cut through its stomach, using &lt;code&gt;Process.kill(:QUIT, 0)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;But… how do I get it to work in Picky?&lt;/p&gt;
&lt;h2&gt;How you configure it in Picky&lt;/h2&gt;
&lt;p&gt;Simple – you open a http interface in &lt;code&gt;app/application.rb&lt;/code&gt; the same way as you would for a query. But this time, instead of a query, you have it point to an instance of &lt;code&gt;LiveParameters&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Like that:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;route %r{\A/admin\Z} =&amp;gt; LiveParameters.new&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;p&gt;And then, you have to…&lt;/p&gt;
&lt;p&gt;No, wait. That&amp;#8217;s it.&lt;/p&gt;
&lt;p&gt;This opens a &lt;span class=&quot;caps&quot;&gt;JSON&lt;/span&gt; interface into the heart of your Picky configuration.&lt;/p&gt;
&lt;h2&gt;The interface&lt;/h2&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;span class=&quot;caps&quot;&gt;HTTP&lt;/span&gt; query params in, &lt;span class=&quot;caps&quot;&gt;JSON&lt;/span&gt; hash out.&lt;/li&gt;
	&lt;li&gt;On success, it returns the complete config, always.&lt;/li&gt;
	&lt;li&gt;On failure, it returns the offending key with the value &amp;#8220;&lt;span class=&quot;caps&quot;&gt;ERROR&lt;/span&gt;&amp;#8221;.&lt;/li&gt;
	&lt;li&gt;If you pass in no query params, nothing will get updated, but you still get the config hash.&lt;/li&gt;
	&lt;li&gt;If you pass in something like &amp;#8230;?querying_splits_text_on=\s, it will update its config to split text on whitespaces.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Beware&lt;/h2&gt;
&lt;p&gt;Just one thing: Be sure to not let your users have access to the live params url.&lt;/p&gt;
&lt;p&gt;And also, be sure not to let your users have access to the live params url.&lt;/p&gt;
&lt;h2&gt;The picky-live gem&lt;/h2&gt;
&lt;p&gt;Because sending the server configuration messages per &lt;span class=&quot;caps&quot;&gt;HTTP&lt;/span&gt; by hand is very tedious, Picky offers a much nicer interface, the picky-live gem.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;gem install picky-live&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Then, just enter&lt;/p&gt;
&lt;p&gt;&lt;code&gt;picky live&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This will start up the Suckerfish web interface on a default port, &lt;a href=&quot;http://localhost:4568&quot;&gt;localhost:4568&lt;/a&gt;, going through the default Suckerfish interface on &lt;a href=&quot;http://localhost:8080/admin&quot;&gt;/admin&lt;/a&gt; in the Picky server.&lt;/p&gt;
&lt;p&gt;If you have customized it to be on &lt;code&gt;/suckerfish&lt;/code&gt; and you don&amp;#8217;t want the Suckerfish web interface on the default port, you&amp;#8217;d type:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;picky live localhost:8080/suckerfish 1234&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This would start up the interface on &lt;a href=&quot;http://localhost:1234&quot;&gt;localhost:1234&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The interface looks like this:
&lt;img src=&quot;/blog/images/suckerfish_interface.png&quot; style=&quot;margin-left: -200px;&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;What you see are three configs that you are currently able to change on the fly. These are the configs for query text handing and wrangling.&lt;/p&gt;
&lt;p&gt;If I change a config in the interface, it will tell me so (currently by changing the background color of the input): 
&lt;img src=&quot;/blog/images/suckerfish_updating.png&quot; style=&quot;margin-left: -200px;&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Then, as soon as I click on the &amp;#8220;Update server now&amp;#8221; button, a suckerfish speeds off, accesses the child through the right &lt;span class=&quot;caps&quot;&gt;URL&lt;/span&gt;, tells the child to update. The child will try to update itself, and if that works, tell the master to update.&lt;/p&gt;
&lt;p&gt;In this example, the updating has failed. The child will tell me so, not tell the parent, and kill itself. (Man, this language we&amp;#8217;re using is brutal!)
&lt;img src=&quot;/blog/images/suckerfish_error.png&quot; style=&quot;margin-left: -200px;&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;Picky needs the child to perform harakiri, since we do not know if the config is still ok.&lt;/p&gt;
&lt;p&gt;If all goes well, the master kills the &lt;strong&gt;other&lt;/strong&gt; children (since they need the updated config) and lets the one telling him to update the config live. You will get a confirmation message, and the interface will update with the current configuration.&lt;/p&gt;
&lt;p&gt;With suckerfish, children will die.&lt;/p&gt;
&lt;p&gt;Sorry about that. What you get in return is a comfortable way of updating the server config on the fly. And that is worth the tradeoff ;)&lt;/p&gt;
&lt;h2&gt;Performance?&lt;/h2&gt;
&lt;p&gt;I bombarded the search server with 100&amp;#8217;000 requests, concurrency 100 using ab:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ab -n 100000 -c 100 127.0.0.1:8080/all/full?query=s&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Then, I started a Suckerfish and updated the config.&lt;/p&gt;
&lt;p&gt;Result: Not really noticeable. A short hiccup when the master reforks, but not really noticeable.&lt;/p&gt;
&lt;p&gt;If the config update fails, since only one worker child dies, the effect is almost not noticeable.&lt;/p&gt;
&lt;p&gt;If the update works, one worker child remains, and the others need to be forked. But Unicorn handles this exceptionally gracefully. Thanks, Unicorn! Really proud of ya. Love you. Still, the harakiri stays.&lt;/p&gt;
&lt;h2&gt;Disclaimer&lt;/h2&gt;
&lt;p&gt;Updating everything on the fly is nice. But beware: The configuration in &lt;code&gt;app/application.rb&lt;/code&gt; will not be updated. After experimenting with Suckerfish, you still need to update the config by hand.&lt;/p&gt;
&lt;p&gt;That&amp;#8217;s syntax pepper.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;that we can&amp;#8217;t just update a config in a child (in a multiprocessing server)&lt;/li&gt;
	&lt;li&gt;how a child can communicate with its parent&lt;/li&gt;
	&lt;li&gt;how Picky does it&lt;/li&gt;
	&lt;li&gt;how the the picky-live gem looks and works&lt;/li&gt;
	&lt;li&gt;How you can try it yourself&lt;/li&gt;
	&lt;li&gt;that it is fast&lt;/li&gt;
	&lt;li&gt;that it can be dangerous if you don&amp;#8217;t know what to do&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Searching with Picky&#58; Live Parameters Part 1</title>
   <link href="http://florianhanke.com/blog/2011/01/25/searching-with-picky-live-parameters-part-1.html"/>
   <updated>2011-01-25T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/01/25/searching-with-picky-live-parameters-part-1</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its workings. If you haven&amp;#8217;t tried it yet, do so in the &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;Getting Started&lt;/a&gt; section. It&amp;#8217;s quick and painless :)&lt;/p&gt;
&lt;p&gt;This time I want to do a two-part post on live parameters.&lt;/p&gt;
&lt;h2&gt;What are Live Parameters?&lt;/h2&gt;
&lt;p&gt;Imagine this situation:&lt;/p&gt;
&lt;p&gt;You are sitting at your desk. A few levels below is an array of Picky servers, contentedly humming at a bagillion requests per second…&lt;/p&gt;
&lt;p&gt;Ok, this is actually a fantasy of mine, but bear with me.&lt;/p&gt;
&lt;p&gt;Suddenly, your boss enters, his hair pointier than ever!&lt;/p&gt;
&lt;p&gt;He tells you that a customer&amp;#8217;s space bar is not working anymore and now he&amp;#8217;d like to use the comma &lt;code&gt;,&lt;/code&gt; character to designate where words are separated.&lt;/p&gt;
&lt;p&gt;Of course you roll your eyes, but he doesn&amp;#8217;t give up. The customer needs to be served, no matter what!&lt;/p&gt;
&lt;p&gt;At this point, what would be really good to have is a way of changing Picky&amp;#8217;s behaviour with splitting words in queries.&lt;/p&gt;
&lt;p&gt;(Btw, the &lt;code&gt;splits_text_on&lt;/code&gt; option, a regexp, defines how picky splits text into tokens, or words.)&lt;/p&gt;
&lt;p&gt;And you do, but: What you have to do now is change the config, deploy, restart the whole cluster (or send Unicorn the &lt;code&gt;HUP&lt;/code&gt; signal to have it restart), losing a fantastic amount of &lt;span class=&quot;caps&quot;&gt;CPU&lt;/span&gt; cycles that would have been better used for searching with Picky.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/images/suckerfish1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;This would be called changing &lt;em&gt;lame parameters&lt;/em&gt;. Live parameters are the cool counterpart of lame parameters, the ones with hair, a sunny disposition, having that certain &lt;em&gt;je-ne-sais-quoi&lt;/em&gt; that only surfers have.&lt;/p&gt;
&lt;p&gt;Live parameters are parameters that can be changed hot – in the running server.&lt;/p&gt;
&lt;p&gt;Now wouldn&amp;#8217;t that be nice? Turns out it isn&amp;#8217;t as easy as I thought.&lt;/p&gt;
&lt;h2&gt;How do I achieve this?&lt;/h2&gt;
&lt;p&gt;The problem is that the Unicorn master – or with any multiprocessing-based server – holds the original copy of the configuration. You can easily update it in a child, but if the child dies, it will be replaced with a new one which has forgotten everything.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/images/suckerfish2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;So let&amp;#8217;s call this thing that updates the configuration a &lt;a href=&quot;http://en.wikipedia.org/wiki/Echeneidae&quot;&gt;Suckerfish&lt;/a&gt;. Suckerfishes – or Remoras – attach to a host (Fig. A), mostly sharks, by sucking onto them. This suckerfish (in the form of a request) would attach itself to a child, and from there open a channel, a pipe, to the master, where it could update the master config.&lt;/p&gt;
&lt;p&gt;So after attaching itself, this fish would then whisper Picky sweet and golden nothings in its ear, causing it to update its master config.&lt;/p&gt;
&lt;h2&gt;That&amp;#8217;s fine, but where can I try it?&lt;/h2&gt;
&lt;p&gt;Suckerfish is ready, but not release-ready yet. So you could &lt;a href=&quot;http://github.com/floere/picky&quot;&gt;clone picky&lt;/a&gt;, and call &lt;code&gt;./install&lt;/code&gt; in the top level directory to install all 1.3.0 gems locally.&lt;/p&gt;
&lt;p&gt;But bear with me, for in part 2 (after the release of 1.3.0 and the picky-live gem, the &amp;#8220;Suckerfish&amp;#8221; gem) I&amp;#8217;ll show how this can be done and how you can use Suckerfish as a weapon against pointy-haired bosses, or just for easy experimentation with your search parameters.&lt;/p&gt;
&lt;p&gt;Don&amp;#8217;t worry, it will get technical soon ;)&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Searching with Picky&#58; Data Sources</title>
   <link href="http://florianhanke.com/blog/2011/01/20/searching-with-picky-data-sources.html"/>
   <updated>2011-01-20T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/01/20/searching-with-picky-data-sources</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its configuration. If you haven&amp;#8217;t tried it yet, do so in the &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;Getting Started&lt;/a&gt; section. It&amp;#8217;s quick and painless :)&lt;/p&gt;
&lt;h2&gt;What is a Data Source in Picky?&lt;/h2&gt;
&lt;p&gt;A data source is where the indexes get their data. Every index needs a data source.&lt;/p&gt;
&lt;p&gt;The way to do this is pass the &lt;code&gt;index(identifier, source)&lt;/code&gt; method&amp;#8217;s source param a source instance, like so (in &lt;code&gt;app/application.rb&lt;/code&gt;):
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;books_index = index :books, Sources::DB.new('SELECT id, title, author FROM books', file: 'app/db.yml')&lt;/code&gt;&lt;/pre&gt;
Here we passed a database source that uses a simple select. Which database the source uses is defined in the file &lt;code&gt;app/db.yml&lt;/code&gt; and follows the configuration structure of Active Record. You could, instead of passing in a &lt;code&gt;file&lt;/code&gt; option, just pass in the Active Record config hash.&lt;/p&gt;
&lt;p&gt;There are various data sources already defined beside the DB source (see below), but if the one you need is missing, writing your own is easy.&lt;/p&gt;
&lt;p&gt;After that comes the most important part in Picky! :) No, really. Because what we are now going to do is categorize the data we got from the source.&lt;/p&gt;
&lt;p&gt;Categorizing the data is so important, because it allows Picky to make guesses as to which category a query word is in and get better feedback from the user. Say, if you categorized both first name and last name in the category &lt;code&gt;name&lt;/code&gt;, Picky would not be able to help your users find what you are looking for, since it can&amp;#8217;t ask back specifically what you mean, like &amp;#8220;Did you mean Florian as first name or last name?&amp;#8221;.&lt;/p&gt;
&lt;p&gt;It&amp;#8217;s best if you just &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;get started&lt;/a&gt;, and see for yourself. Picky is best experienced, and not told.&lt;/p&gt;
&lt;p&gt;Back to the example: Now that we have defined a data source, it&amp;#8217;s easy to define a category on it. If you define a &lt;code&gt;title&lt;/code&gt; category
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;books_index.define_category :title&lt;/code&gt;&lt;/pre&gt;
it will use whatever data came back from the database.&lt;/p&gt;
&lt;p&gt;If your database doesn&amp;#8217;t have nice column names, don&amp;#8217;t worry, you have two options:
Do a &lt;code&gt;SELECT id, t_01 as title ...&lt;/code&gt; or use the &lt;code&gt;from&lt;/code&gt; option when you define the category:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;books_index.define_category :title, :from =&amp;gt; :t_01&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;from&lt;/code&gt; option is quite cool, as it allows you to have multiple categories on the same data! Say you wanted a similarity search in one category and none on the other:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;books_index.define_category :title, :from =&amp;gt; :t_01
books_index.define_category :similar_title, :from =&amp;gt; :t_01, similarity: Similarity::Phonetic.new(3)&lt;/code&gt;&lt;/pre&gt;
Lots of possibilities, I&amp;#8217;m sure you&amp;#8217;ll find more useful ones!&lt;/p&gt;
&lt;p&gt;There&amp;#8217;s more. You can have crazy indexes where every category has its own data source:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;books_index.define_category :title, source: Sources::CSV.new(:title, :author, file: 'data/library.csv', col_sep: ',')&lt;/code&gt;&lt;/pre&gt;
Now the title category takes its data from a library.csv. If you do this, be careful that all data sources use the same ids or Picky&amp;#8217;s core mechanism won&amp;#8217;t work.&lt;/p&gt;
&lt;h2&gt;Currently available data sources&lt;/h2&gt;
&lt;p&gt;Picky offers a few data sources, &lt;code&gt;DB&lt;/code&gt; for databases, &lt;code&gt;CSV&lt;/code&gt; for comma-separated files, &lt;code&gt;Couch&lt;/code&gt; for couch DB, and &lt;code&gt;Delicious&lt;/code&gt;, for delicious bookmarks. Mmh.&lt;/p&gt;
&lt;p&gt;This is how you use them. We&amp;#8217;ve already seen the database source:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Sources::DB.new('SELECT id, title, author FROM books', file: 'app/db.yml')&lt;/code&gt;&lt;/pre&gt;
Don&amp;#8217;t hesitate to use JOINs or other &lt;span class=&quot;caps&quot;&gt;SQL&lt;/span&gt; expressions for some extreme databasing!
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Sources::CSV.new(:title, :author, :isbn, :year, :publisher, :subjects, file: 'data/books.csv')&lt;/code&gt;&lt;/pre&gt;
This source assumes that your first column is the id column. It takes its data from the file given in the &lt;code&gt;file&lt;/code&gt; option.
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Sources::Couch.new(:title, :author, :isbn, url: 'http://localhost:5984/picky', keys: Sources::Couch::UUIDKeys.new)&lt;/code&gt;&lt;/pre&gt;
The CouchDB source takes a url where couch DB serves its data. By default it assumes that you are using Hex Keys. But you can pass in one of &lt;code&gt;Sources::Couch::HexKeys.new&lt;/code&gt;, &lt;code&gt;Sources::Couch::UUIDKeys.new&lt;/code&gt;, or &lt;code&gt;Sources::Couch::IntegerKeys.new&lt;/code&gt; in the &lt;code&gt;keys&lt;/code&gt; option to tell Picky what keys you have.
I&amp;#8217;m afraid that currently you have to recalculate your keys in the client to get back the original keys. I am working on non-integer keys, but it takes its time. Sorry about that.
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Sources::Delicious.new(:username, :password)&lt;/code&gt;&lt;/pre&gt;
Delicious is the easiest source, since it comes with fixed data categories &lt;code&gt;title&lt;/code&gt;, &lt;code&gt;tags&lt;/code&gt;, &lt;code&gt;url&lt;/code&gt; that you can categorize.&lt;/p&gt;
&lt;h2&gt;How do I define my own Data Source?&lt;/h2&gt;
&lt;p&gt;Defining your own source is easy. The Couch DB source for example has actually been sent in by &lt;a href=&quot;http://github.com/stanley&quot;&gt;Stanley&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This piece of code is the superclass of all sources in Picky and is there simply for illustrative purposes, so you can see what methods should be implemented:
&lt;a href=&quot;http://github.com/floere/picky/blob/master/server/lib/picky/sources/base.rb&quot;&gt;http://github.com/floere/picky/blob/master/server/lib/picky/sources/base.rb&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I recommend to make your source also its subclass, since it implements empty methods that are called by the indexer. But it actually just needs one worker method. This one:
&lt;code&gt;harvest(index, category)&lt;/code&gt;
It gets the index and the current category and should &lt;code&gt;yield(id, text_data_for_id)&lt;/code&gt;. It is called by the indexer when it needs the data.&lt;/p&gt;
&lt;p&gt;The two other methods that are called by the indexer are
&lt;code&gt;connect_backend&lt;/code&gt;, which is called once per index/category, and &lt;code&gt;take_snapshot&lt;/code&gt;, which is called once for each index, before &lt;code&gt;harvest&lt;/code&gt;-ing the data. Use it to create temporary tables etc.&lt;/p&gt;
&lt;p&gt;So if your duck subclasses &lt;code&gt;Sources::Base&lt;/code&gt;, quacks &lt;code&gt;#harvest&lt;/code&gt; and yields &lt;code&gt;id, text_data_for_id&lt;/code&gt; your data source is set to go!&lt;/p&gt;
&lt;p&gt;Simple and easy to understand, isn&amp;#8217;t it?&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;what a data source in Picky is.&lt;/li&gt;
	&lt;li&gt;what data sources are currently available.&lt;/li&gt;
	&lt;li&gt;how you write your own.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;
&lt;h2&gt;Contributing one to Picky&lt;/h2&gt;
&lt;p&gt;If you write your own data source, please let me know!&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Searching with Picky&#58; Partial Search</title>
   <link href="http://florianhanke.com/blog/2011/01/17/searching-with-picky-partial-search.html"/>
   <updated>2011-01-17T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/01/17/searching-with-picky-partial-search</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its configuration. If you haven&amp;#8217;t tried it yet, do so in the &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;Getting Started&lt;/a&gt; section. It&amp;#8217;s quick and painless :)&lt;/p&gt;
&lt;h2&gt;What is a Partial Search?&lt;/h2&gt;
&lt;p&gt;Partial searching is when the user only enters part of a query word, but the search engine still manages to find the whole word.&lt;/p&gt;
&lt;p&gt;Example:
We want to find all &lt;code&gt;chunky bacon&lt;/code&gt;. If the search engine supports a partial search, we should be able to search for just &lt;code&gt;chunky ba&lt;/code&gt; and &lt;code&gt;chunky bacon&lt;/code&gt; will still be found.&lt;/p&gt;
&lt;p&gt;Note that &lt;code&gt;chunky bards&lt;/code&gt; will also be found, and so will &lt;code&gt;chunky babes&lt;/code&gt;. So beware.&lt;/p&gt;
&lt;p&gt;Usually, the character used for partial searches is the asterisk, &lt;code&gt;*&lt;/code&gt;.
So you would search for &lt;code&gt;chunky ba*&lt;/code&gt; to have the search engine look for &lt;code&gt;ba&lt;/code&gt; followed by anything.&lt;/p&gt;
&lt;h2&gt;In Picky&lt;/h2&gt;
&lt;p&gt;At the time of writing, Picky offers a postfix partial search, meaning that only words &lt;em&gt;ending&lt;/em&gt; in anything can be searched. (Or a &lt;code&gt;Partial::None&lt;/code&gt; partial search that just ignores the &lt;code&gt;*&lt;/code&gt;.)&lt;/p&gt;
&lt;p&gt;The thing you use is &lt;code&gt;Partial::Substring&lt;/code&gt;, like this:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;some_index = index :main, Sources::DB.new('SELECT id, title FROM books', file: 'app/db.yml')
some_index.define_category :title, partial: Partial::Substring.new(from: 1)&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;p&gt;So you define a data category on the index and give it the &lt;code&gt;partial&lt;/code&gt; option. With this option you tell Picky to use the following class for generating the index in a special way to support partial indexing and querying.&lt;/p&gt;
&lt;p&gt;What we want in the example above is have Picky use a &lt;code&gt;Partial::Substring&lt;/code&gt;, and have a query word match &lt;code&gt;from&lt;/code&gt; the first position (position &lt;code&gt;1&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Example:
A word like &lt;code&gt;picky&lt;/code&gt; would match on &lt;code&gt;p&lt;/code&gt;, &lt;code&gt;pi&lt;/code&gt;, &lt;code&gt;pic&lt;/code&gt;, &lt;code&gt;pick&lt;/code&gt; and &lt;code&gt;picky&lt;/code&gt;. If you defined &lt;code&gt;from: 3&lt;/code&gt;, then it would only match &lt;code&gt;pic&lt;/code&gt;, &lt;code&gt;pick&lt;/code&gt;, &lt;code&gt;picky&lt;/code&gt;. Setting &lt;code&gt;from&lt;/code&gt; to &lt;code&gt;1&lt;/code&gt; is indexing intensive, but will find everything.&lt;/p&gt;
&lt;p&gt;It is super-easy to write your own partial search. See below for that. The sky is the limit, basically.&lt;/p&gt;
&lt;p&gt;On a side-note: Picky will always search the last word of a query with a &lt;code&gt;*&lt;/code&gt;, except if you use double quotes, like so: &lt;code&gt;&quot;chunky bac&quot;&lt;/code&gt;. This will really only find &lt;code&gt;chunky bac&lt;/code&gt;, not &lt;code&gt;chunky bacon&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;How does Picky do this?&lt;/h2&gt;
&lt;p&gt;Picky aims to be very extensible, so what it does is very simple.&lt;/p&gt;
&lt;p&gt;Picky uses a partial generator, like &lt;code&gt;Partial::Substring&lt;/code&gt; which takes an exact index (more below) and returns a partial index.&lt;/p&gt;
&lt;p&gt;An exact index in Picky is just a hash that maps words to an array of ids.&lt;/p&gt;
&lt;p&gt;So &lt;code&gt;Partial::Substring.new(from: 3)&lt;/code&gt; takes something like that:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;{
  :picky =&amp;gt; [1, 16, 3, 999],
  :pickle =&amp;gt; [800, 3, 55]
}
&lt;/code&gt;&lt;/pre&gt;
(the index for exact matches) and transforms it into something like that:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;{
  :pickle =&amp;gt; [800, 3, 55],
  :pickl  =&amp;gt; [800, 3, 55],
  :picky =&amp;gt; [1, 16, 3, 999],
  :pick  =&amp;gt; [1, 16, 3, 999, 800, 3, 55],
  :pic  =&amp;gt; [1, 16, 3, 999, 800, 3, 55]
}
&lt;/code&gt;&lt;/pre&gt;
So in &lt;code&gt;pic&lt;/code&gt;, there are both the ids from &lt;code&gt;picky&lt;/code&gt; and the ids from &lt;code&gt;pickle&lt;/code&gt;. If someone looks for &lt;code&gt;pic&lt;/code&gt;, we return a mix of both ids.&lt;/p&gt;
&lt;h2&gt;How do I define my own Partial Search?&lt;/h2&gt;
&lt;p&gt;It is extremely simple. A partial search just needs to implement a &lt;code&gt;generate_from(exact_index)&lt;/code&gt; method that returns the new partial index.&lt;/p&gt;
&lt;p&gt;You could for example implement a partial index that has &lt;em&gt;random&lt;/em&gt; substring matches of up to 3 characters (silly, I know :)):
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;class Partial::Random
  def generate_from exact_index
    exact_index.inject({}) do |partial_index, word_and_ids|
      word, ids = *word_and_ids
      start  = rand word.size
      ending = rand(3) + 1
      random_substring = word[start, ending]
      partial_index[random_substring] ||= []
      partial_index[random_substring] += ids
      partial_index
    end
  end
end
&lt;/code&gt;&lt;/pre&gt;
This method returns a new index that might look like this:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;Partial::Random.new.generate_from(:picky =&amp;gt; [1,2,3]) # =&amp;gt; { :ick =&amp;gt; [1,2,3] }
&lt;/code&gt;&lt;/pre&gt;
Of course, the example is not very performant – but legible for you.&lt;/p&gt;
&lt;p&gt;Finally, you&amp;#8217;d use it for your data categories in &lt;code&gt;app/application.rb&lt;/code&gt; like this:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;some_index = index :main, Sources::DB.new('SELECT id, title FROM books', file: 'app/db.yml')
some_index.define_category :title, partial: Partial::Random.new
&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;p&gt;A better idea might be to create a substring partial that generates a partial index where the asterisk is actually at the front of the word:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;{
  :picky =&amp;gt; [1,2,3],
  :icky  =&amp;gt; [1,2,3],
  :cky   =&amp;gt; [1,2,3],
  :ky    =&amp;gt; [1,2,3],
  :y     =&amp;gt; [1,2,3]
}
&lt;/code&gt;&lt;/pre&gt;
This will match &lt;code&gt;picky&lt;/code&gt; if you enter just a &lt;code&gt;y&lt;/code&gt;!&lt;/p&gt;
&lt;p&gt;Picky is very flexible – do what you want however you want it.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;what a partial search is.&lt;/li&gt;
	&lt;li&gt;how Picky does a partial search.&lt;/li&gt;
	&lt;li&gt;how a partial search is configured in Picky.&lt;/li&gt;
	&lt;li&gt;how you can write your own.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;
&lt;h2&gt;Contributing one to Picky&lt;/h2&gt;
&lt;p&gt;If you write your own, please let me know!&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Searching with Picky&#58; Character&nbsp;Substitution</title>
   <link href="http://florianhanke.com/blog/2011/01/13/searching-with-picky-character-substituters.html"/>
   <updated>2011-01-13T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2011/01/13/searching-with-picky-character-substituters</id>
   <content type="html">&lt;p&gt;This is a post in the &lt;a href=&quot;http://florianhanke.com/picky/index.html&quot;&gt;Picky&lt;/a&gt; series on its configuration. If you haven&amp;#8217;t tried it yet, do so in the &lt;a href=&quot;http://florianhanke.com/picky/getting_started.html&quot;&gt;Getting Started&lt;/a&gt; section. It&amp;#8217;s quick and painless :)&lt;/p&gt;
&lt;h2&gt;What is Character Substitution?&lt;/h2&gt;
&lt;p&gt;Character substitution in a search engine is one of the first steps in the process of sanitizing your users&amp;#8217; input.&lt;/p&gt;
&lt;p&gt;Examples:
&lt;code&gt;ä =&amp;gt; ae&lt;/code&gt;,
&lt;code&gt;ø =&amp;gt; o&lt;/code&gt;,
&lt;code&gt;é =&amp;gt; e&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This is used to make the search engine indifferent to a user&amp;#8217;s origin or way of writing.&lt;/p&gt;
&lt;p&gt;For example, my hometown is called &lt;code&gt;Zürich&lt;/code&gt;, with an &lt;em&gt;umlaut&lt;/em&gt; character, &lt;code&gt;ü&lt;/code&gt;.
German users will search with an ü. However, most users of the world don&amp;#8217;t know this character, and will simply type &lt;code&gt;Zurich&lt;/code&gt;. So what we want is make the search engine ignore the &lt;em&gt;umlaut diacritics&lt;/em&gt;, the two dots over the u.&lt;/p&gt;
&lt;h2&gt;How do we do this?&lt;/h2&gt;
&lt;p&gt;Usually, what search engines do is perform a sort of &lt;em&gt;character substitution&lt;/em&gt; before putting text into the index, so &lt;code&gt;Zürich&lt;/code&gt; will go into the index as &lt;code&gt;zurich&lt;/code&gt;. For that, we character substituted &lt;code&gt;ü =&amp;gt; u&lt;/code&gt;. I also &lt;em&gt;lowercased&lt;/em&gt; it, since that is what search engines also do, to significantly save index space.&lt;/p&gt;
&lt;p&gt;So now we have &lt;code&gt;Zurich&lt;/code&gt; in the index. If a user now searched for &lt;code&gt;Zürich&lt;/code&gt;, the search engine wouldn&amp;#8217;t find it.&lt;/p&gt;
&lt;p&gt;So what we do is also perform this character substitution in a query, so that if the user enters an &lt;code&gt;ü&lt;/code&gt;, it is replaced by an &lt;code&gt;u&lt;/code&gt;, making &lt;code&gt;Zurich&lt;/code&gt; out of &lt;code&gt;Zürich&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In a nutshell, the indexing and the querying map both &lt;code&gt;Zürich&lt;/code&gt; and &lt;code&gt;Zurich&lt;/code&gt; to &lt;code&gt;Zurich&lt;/code&gt; and a user will find it, regardless if they searched for my hometown with or without umlaut.&lt;/p&gt;
&lt;h2&gt;How do we do this in Picky?&lt;/h2&gt;
&lt;p&gt;Picky offers two class methods in a Picky &lt;code&gt;Application&lt;/code&gt; where you can define how characters are substituted, amongst other things:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;code&gt;default_indexing options = {}&lt;/code&gt;&lt;/li&gt;
	&lt;li&gt;&lt;code&gt;default_querying options = {}&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The &lt;code&gt;default_&lt;/code&gt; in the method name comes from the fact that whatever options are given, will be used for all indexing and querying unless overridden. So most of the time you will be configuring it there.&lt;/p&gt;
&lt;p&gt;One of the options is &lt;code&gt;substitutes_characters_with&lt;/code&gt; and you give it a character substituter object that has a &lt;code&gt;#substitute(text)&lt;/code&gt; method.&lt;/p&gt;
&lt;p&gt;Picky already includes one for west european character sets. You use it as follows:&lt;/p&gt;
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;default_indexing substitutes_characters_with: CharacterSubstituters::WestEuropean.new&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I use the Ruby 1.9 hash style, &lt;code&gt;key: value&lt;/code&gt;, for that. The rocket I use for mapping things, &lt;code&gt;map '/some/path' =&amp;gt; controller&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;What the west european character substituter does is this:
&lt;code&gt;ä =&amp;gt; ae&lt;/code&gt;,
&lt;code&gt;Ä =&amp;gt; Ae&lt;/code&gt;,
&lt;code&gt;ë =&amp;gt; e&lt;/code&gt;,
&lt;code&gt;Ë =&amp;gt; E&lt;/code&gt;,
&lt;code&gt;ï =&amp;gt; i&lt;/code&gt;,
&lt;code&gt;Ï =&amp;gt; I&lt;/code&gt;,
&lt;code&gt;ö =&amp;gt; oe&lt;/code&gt;,
&lt;code&gt;Ö =&amp;gt; Oe&lt;/code&gt;,
&lt;code&gt;ü =&amp;gt; ue&lt;/code&gt;,
&lt;code&gt;Ü =&amp;gt; Ue&lt;/code&gt;,
and 22 others. See &lt;a href=&quot;http://github.com/floere/picky/blob/master/server/spec/lib/character_substituters/west_european_spec.rb&quot;&gt;the spec&lt;/a&gt; if you&amp;#8217;d like to know more.&lt;/p&gt;
&lt;p&gt;So a query like &lt;code&gt;Hände Nüsse&lt;/code&gt; will be sanitized to &lt;code&gt;haende nuesse&lt;/code&gt; before being further processed. Again also lowercasing it, since this is usually also done.&lt;/p&gt;
&lt;h2&gt;How do I define my own character substituter?&lt;/h2&gt;
&lt;p&gt;It is extremely simple. A character substituter just needs to implement a &lt;code&gt;substitute(text)&lt;/code&gt; method that returns the substituted text.&lt;/p&gt;
&lt;p&gt;See &lt;a href=&quot;http://github.com/floere/picky/blob/master/server/lib/picky/character_substituters/west_european.rb&quot;&gt;the source of the west european substituter&lt;/a&gt; if you want to see how I did it.&lt;/p&gt;
&lt;p&gt;Why is it so illegibly written?&lt;/p&gt;
&lt;p&gt;It is heavily optimized. Since this method will be called for all indexed data, and for each query, it should be performant.&lt;/p&gt;
&lt;p&gt;The west european spec includes two performance specs for that:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;describe &quot;speed&quot; do
  it &quot;is fast&quot; do
    result = performance_of { @substituter.substitute('ä') }
    result.should &amp;lt; 0.00009
  end
  it &quot;is fast&quot; do
    result = performance_of { @substituter.substitute('abcdefghijklmnopqrstuvwxyz1234567890') }
    result.should &amp;lt; 0.00015
  end
end
&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;p&gt;The method &lt;code&gt;performance_of&lt;/code&gt; is used in Picky quite often to maintain performance and notify me should anything get slower. It looks like this:
&lt;pre class=&quot;sh_ruby&quot;&gt;&lt;code&gt;def performance_of &amp;amp;block
  GC.disable
  result = Benchmark.realtime &amp;amp;block
  GC.enable
  result
end
&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So we&amp;#8217;ve seen&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;that most search engines need a character substituter.&lt;/li&gt;
	&lt;li&gt;that character substituter help your international users find things.&lt;/li&gt;
	&lt;li&gt;how they are configured in Picky.&lt;/li&gt;
	&lt;li&gt;how you can write your own.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hope you learnt something new :)&lt;/p&gt;
&lt;h2&gt;Contributing one to Picky&lt;/h2&gt;
&lt;p&gt;If you write your own, please let me know!&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Speccing methods called in initialize</title>
   <link href="http://florianhanke.com/blog/2010/10/27/speccing-methods-called-in-initialize.html"/>
   <updated>2010-10-27T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2010/10/27/speccing-methods-called-in-initialize</id>
   <content type="html">&lt;p&gt;Recently when writing &lt;a href=&quot;http://floere.github.com/picky/&quot;&gt;Picky, the clever small text search engine&lt;/a&gt;, I encountered the following problem: How do I test methods that are called in an initializer?&lt;/p&gt;
&lt;p&gt;(Of course I could call &lt;code&gt;Testee.new&lt;/code&gt; in the spec and then just call the method again. But what if that method sets a state?)&lt;/p&gt;
&lt;p&gt;In code:
&lt;script src=&quot;http://gist.github.com/648878.js&quot;&gt;&lt;/script&gt;&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Why open sourcing security critical software is important</title>
   <link href="http://florianhanke.com/blog/2010/10/06/why-open-sourcing-security-critical-software-is-important.html"/>
   <updated>2010-10-06T00:00:00+11:00</updated>
   <id>http://florianhanke.com/blog/2010/10/06/why-open-sourcing-security-critical-software-is-important</id>
   <content type="html">&lt;p&gt;&lt;a href=&quot;http://www.freedom-to-tinker.com/blog/jhalderm/hacking-dc-internet-voting-pilot&quot;&gt;Why open sourcing security critical software is important&lt;/a&gt;&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Profiling MySQL Queries</title>
   <link href="http://florianhanke.com/blog/2010/09/27/in-detail-performance-measurements-for-MySQL.html"/>
   <updated>2010-09-27T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/09/27/in-detail-performance-measurements-for-MySQL</id>
   <content type="html">&lt;p&gt;&lt;a href=&quot;http://dev.mysql.com/tech-resources/articles/using-new-query-profiler.html&quot;&gt;Profiling MySQL Queries&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;In-detail performance measurements for MySQL queries.&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Drawing in the browser</title>
   <link href="http://florianhanke.com/blog/2010/05/22/drawing-in-the-browser.html"/>
   <updated>2010-05-22T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/05/22/drawing-in-the-browser</id>
   <content type="html">&lt;p&gt;&lt;a href=&quot;http://mugtug.com/sketchpad/&quot;&gt;Drawing in the Browser&lt;/a&gt;&lt;/a&gt;
&amp;#8230; using HTML5.&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Most important Ruby method 2010</title>
   <link href="http://florianhanke.com/blog/2010/05/21/most-important-ruby-method.html"/>
   <updated>2010-05-21T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/05/21/most-important-ruby-method</id>
   <content type="html">&lt;p&gt;It&amp;#8217;s &lt;code&gt;squeeze&lt;/code&gt;!
&lt;script src=&quot;http://gist.github.com/408937.js&quot;&gt;&lt;/script&gt;&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Programming Applied Mathematics</title>
   <link href="http://florianhanke.com/blog/2010/05/13/programming-applied-mathematics.html"/>
   <updated>2010-05-13T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/05/13/programming-applied-mathematics</id>
   <content type="html">&lt;p&gt;&lt;code&gt;Programming is one of the most difficult branches of applied mathematics / the poorer mathematicians had better remain pure mathematicians.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;– Edsger W. Dijkstra&lt;/p&gt;
&lt;p&gt;(via &lt;a href=&quot;http://fuckyeahcomputerscience.tumblr.com/&quot;&gt;fuckyeahcomputerscience&lt;/a&gt;)&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>New programming jargon</title>
   <link href="http://florianhanke.com/blog/2010/05/11/new-programming-jargon.html"/>
   <updated>2010-05-11T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/05/11/new-programming-jargon</id>
   <content type="html">&lt;p&gt;&lt;a href=&quot;http://www.globalnerdy.com/2010/05/09/new-programming-jargon/&quot;&gt;New Programming Jargon&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Need to remember Bugfoot and Shrug Report… And especially Duck!&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Fat slows you down</title>
   <link href="http://florianhanke.com/blog/2010/05/09/fat-slows-you-down.html"/>
   <updated>2010-05-09T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/05/09/fat-slows-you-down</id>
   <content type="html">&lt;p&gt;Fat slows you down.&lt;/p&gt;
&lt;p&gt;If you really need speed in Ruby 1.9, consider this example:
&lt;script src=&quot;http://gist.github.com/395419.js&quot;&gt;&lt;/script&gt;&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>You already knew that, right? (Assigning with splats)</title>
   <link href="http://florianhanke.com/blog/2010/04/30/you-already-knew-that-right.html"/>
   <updated>2010-04-30T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/30/you-already-knew-that-right</id>
   <content type="html">&lt;script src=&quot;http://gist.github.com/385121.js&quot;&gt;&lt;/script&gt;&lt;p&gt;Referring to the fact that I want to sleep with the splat operator…&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>97% is as good as a 100%</title>
   <link href="http://florianhanke.com/blog/2010/04/30/if-you-re-in-a-hurry.html"/>
   <updated>2010-04-30T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/30/if-you-re-in-a-hurry</id>
   <content type="html">&lt;p&gt;&lt;code&gt;If you're in a hurry and you need to pack up your bags and go, 97% is as good as a 100%. The 100% mark does not have the same (show-stopping) magic as 0%, where the difference between 3% and 0% really is important.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;– &lt;a href=&quot;http://www.two-sdg.demon.co.uk/curbralan/papers/minimalism/OmitNeedlessCode.html&quot;&gt;Omit Needless Code&lt;/a&gt;&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>elements.each(*p)</title>
   <link href="http://florianhanke.com/blog/2010/04/30/elements-each-p.html"/>
   <updated>2010-04-30T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/30/elements-each-p</id>
   <content type="html">&lt;p&gt;I often use&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ary.map(&amp;amp;:upcase)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;instead of&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ary.map { |a| a.upcase }&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;But what can I do to use the elements as param as in the following code?&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ary.each { |a| p a }&lt;/code&gt;&lt;/p&gt;
&lt;script src=&quot;http://gist.github.com/385117.js&quot;&gt;&lt;/script&gt;</content>
   
 </entry>
 
 <entry>
   <title>Strategy pattern pattern pattern pattern</title>
   <link href="http://florianhanke.com/blog/2010/04/29/strategy-pattern-pattern-pattern-pattern.html"/>
   <updated>2010-04-29T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/29/strategy-pattern-pattern-pattern-pattern</id>
   <content type="html">&lt;p&gt;A pattern that I often see cropping up in my &lt;a href=&quot;http://github.com/floere/gosu_extensions&quot;&gt;game framework&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;It can be used for configuring subclasses that act according to an order of calls defined in the superclass. How the calls exactly work can be defined in the subclasses (or in an external configuration) using the class methods.&lt;/p&gt;
&lt;script src=&quot;http://gist.github.com/383325.js&quot;&gt;&lt;/script&gt;</content>
   
 </entry>
 
 <entry>
   <title>Mastery is a mindset</title>
   <link href="http://florianhanke.com/blog/2010/04/26/mastery-is-a-mindset.html"/>
   <updated>2010-04-26T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/26/mastery-is-a-mindset</id>
   <content type="html">&lt;p&gt;&lt;code&gt;Mastery is a mindset.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;From the book &amp;#8220;Drive&amp;#8221;, by Pink.&lt;/p&gt;
&lt;p&gt;I&amp;#8217;d reformulate it as: &amp;#8220;Mastery is neither a question of time, or experience, but a mindset.&amp;#8221;&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Ruby 1.9 params</title>
   <link href="http://florianhanke.com/blog/2010/04/20/ruby-19-params.html"/>
   <updated>2010-04-20T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/20/ruby-19-params</id>
   <content type="html">&lt;script src=&quot;http://gist.github.com/372372.js&quot;&gt;&lt;/script&gt;</content>
   
 </entry>
 
 <entry>
   <title>Riddle</title>
   <link href="http://florianhanke.com/blog/2010/04/18/riddle.html"/>
   <updated>2010-04-18T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/18/riddle</id>
   <content type="html">&lt;p&gt;&lt;code&gt;3735928559&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Why is this number unappealing to vegetarians?&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>A hole in the wall</title>
   <link href="http://florianhanke.com/blog/2010/04/18/a-hole-in-the-wall.html"/>
   <updated>2010-04-18T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/18/a-hole-in-the-wall</id>
   <content type="html">&lt;p&gt;His stool leaned back at a dangerous angle, he displays a pair of jamaica-colored sneakers to the public. Them sticking out of his business hole seems rather odd, considering the sober surroundings of the Niederdorf, or &amp;#8220;nether village&amp;#8221;, as this particular place in Zürich is called.&lt;/p&gt;
&lt;p&gt;Slurping a botanic tea, idly facebooking and tumbling through the depths, no, shallows of the net, waiting for customers. It&amp;#8217;s been that way now for more than a day, and he starts to wonder if the customer specific context ads are just a fluke.&lt;/p&gt;
&lt;p&gt;An abrupt &amp;#8220;Oh hey&amp;#8221; directed his way throws him out of the structural code improvements that have been waiting for him at the back of his mind. &amp;#8220;Hey&amp;#8221;, a burly businessman with slightly high blood pressure &amp;#8211; he surmises from the corona of hair still clinging on – asks: &amp;#8220;Are you the man that types?&amp;#8221;, &amp;#8220;Yes, yes I do, I code.&amp;#8221; &amp;#8220;Oh, code. Yeah, sorry, my bad. Well, look, I need a small program that does a few calculations based on this.&amp;#8221;&lt;/p&gt;
&lt;p&gt;And he whips out a napkin with a few calculations on it, in black lines what looks to be from an eyeliner, or a piece of coal. &amp;#8220;Don&amp;#8217;t mind the looks – how long do you think this takes?&amp;#8221;&lt;/p&gt;
&lt;p&gt;&amp;#8220;Hmm, well. I think the design might take me a few hours. Then we&amp;#8217;d need to meet again to see if we&amp;#8217;re on the right track. Then I&amp;#8217;ll have to code it, and clean it up a little. Might take me another 2 hours.&amp;#8221;&lt;/p&gt;
&lt;p&gt;&amp;#8220;For 90 an hour, right?&amp;#8221; &amp;#8220;That&amp;#8217;s right, as advertised.&amp;#8221; &amp;#8220;Ok, well. See you in three.&amp;#8221;&lt;/p&gt;
&lt;p&gt;He rights his stool, leans forward, sketches boxes and lines, boxes and lines, lines and boxes. Then he goes for a quick walk, takes in the morning, letting the cogs turn. Half an hour of showing tourists the view, and a hot chocolate at the riverside. Finally, he plumps down in front of his sleek, metal-clad machine and types.&lt;/p&gt;
&lt;p&gt;What he did was transform the mascara lines into byroliner lines and boxes as a straw where the mind can cling on to, and from there to typed text on a luminescent screen, for him to read and others to understand, finally into the core of the machine, and the zeros and ones people who have no understanding regurgitate so often.&lt;/p&gt;
&lt;p&gt;Entering the formula was pretty straightforward. But there are other things to consider: What is the best user interface for a burly businessman? Will it be used repeatedly? As if on cue, burly biz arrives and asks &amp;#8220;Done yet?&amp;#8221; &amp;#8220;Oh hi.&amp;#8221;&lt;/p&gt;
&lt;p&gt;Back and forth: The customer starts with a lot of questions, have you put this in? He cuts him short, and explains what he will see, his understanding of the formula. There is much going on, but boils down to this: The clearing of misunderstandings. And they get cleared. It must be his happy day, the businessman knows the power of an ad-hoc team, and how it should work, how progress can come from it.&lt;/p&gt;
&lt;p&gt;The discussion dies down, lots of nodding all around, and smiles emerge. A handshake, and both are off – shorty no doubt to a meeting, where money and hand sweat is moved, our coder off to the plane of lines and boxes. A prototype stands, but this is not where it ends. He wants it to be perfect. After all, he is a craftsman, and craft is what defines him. The table might look nice to an outsider, but the craft is inside: The distribution of weight, the structure of the wood: What holds the thing together and doesn&amp;#8217;t make it bend, for year after year.&lt;/p&gt;
&lt;p&gt;Before he cleans up however, there is yoga waiting for him, and another stroll an the riverside. Can it be improved? How? The response comes to him during the most innocent of activities, stroking a cat that has found, purring, a new home around his legs. He leaves the cat slightly shocked behind – but she improves the situation by licking her paw – and runs up the street, repeating and repeating the idea, urging it not to leave his head.&lt;/p&gt;
&lt;p&gt;Panting, he types it in. The tests run, the code checker tool give him a green light. He opens it, it works. Puts it on a stick, wraps it in a package, puts it into a nice box which brandishes his logo – doodled on the back of a napkin by his sister, three years ago – and puts it aside for the customer, due to arrive in an hour.&lt;/p&gt;
&lt;p&gt;And finally. Finally the sneakers rest again on the sill of the hole.&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Oh yeah, Amazon?</title>
   <link href="http://florianhanke.com/blog/2010/04/14/oh-yeah-amazon-question-mark.html"/>
   <updated>2010-04-14T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/14/oh-yeah-amazon-question-mark</id>
   <content type="html">&lt;p&gt;From the latest Newsletter:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Support for Session Stickiness in Elastic Load Balancing Amazon Elastic MapReduce Introduces Custom Cluster Configuration Option&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;They also have Gurble Blurble Fickleness, introducing Jambawambing Lordle Figuconation Schnorptions.&lt;/p&gt;
&lt;p&gt;At least that&amp;#8217;s what I hear when I read stuff like that.&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>IE didn't get the CSS3 memo?</title>
   <link href="http://florianhanke.com/blog/2010/04/13/ie-didnt-get-the-css3-memo-question-mark.html"/>
   <updated>2010-04-13T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/13/ie-didnt-get-the-css3-memo-question-mark</id>
   <content type="html">&lt;p&gt;&lt;a href=&quot;http://kimblim.dk/css-tests/selectors/&quot;&gt;IE didn&amp;#8217;t get the CSS3 memo?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Or, as is my guess: The code they based the new browsers on was fully untested, totally disorganized, and thus brutally hard to extend. IE9 though, gives one hope.&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Challenged</title>
   <link href="http://florianhanke.com/blog/2010/04/12/challenged.html"/>
   <updated>2010-04-12T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/12/challenged</id>
   <content type="html">&lt;p&gt;The framework looms in front of you. Clouds cover the gray sky. You plunge in. Full unit test rewrite, nothing is where it was before, but right: The mailbox is in front of the house, the bathtub is finally in the bath, the fridge contains organic food. There is a pot on the fire, full of juicy stuff.&lt;/p&gt;
&lt;p&gt;But you are wearing glasses that let you only see 10 centimeters. You set wild eyes on the integration tests: Guests are entering the house, trying to eat from the toilet, sleeping in the oven, or jumping out of windows. It is fail, fail, fail, wherever you happen to look.&lt;/p&gt;
&lt;p&gt;You are close to despair. Everything is right. Right? You trudge on, teeth gnashing.&lt;/p&gt;
&lt;p&gt;Then, somehow, you adjust the doormat ever so slightly, piece in the last crumb of information. And magically, it just works. Everything. Just. Works. The gargantuan task is finished. For minutes, you revel in the sun&amp;#8217;s rays. The clouds, they never reappear.&lt;/p&gt;
&lt;p&gt;It is done.&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Stuttering Proc</title>
   <link href="http://florianhanke.com/blog/2010/04/07/stuttering-proc.html"/>
   <updated>2010-04-07T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/07/stuttering-proc</id>
   <content type="html">&lt;script src=&quot;http://gist.github.com/358947.js&quot;&gt;&lt;/script&gt;</content>
   
 </entry>
 
 <entry>
   <title>Reloading a running Ruby application</title>
   <link href="http://florianhanke.com/blog/2010/04/05/reloading-a-running-ruby-application.html"/>
   <updated>2010-04-05T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/05/reloading-a-running-ruby-application</id>
   <content type="html">&lt;p&gt;Here&amp;#8217;s how I do it:
&lt;script src=&quot;http://gist.github.com/351776.js&quot;&gt;&lt;/script&gt;&lt;/p&gt;</content>
   
 </entry>
 
 <entry>
   <title>Javuby?</title>
   <link href="http://florianhanke.com/blog/2010/04/05/javuby-question-mark.html"/>
   <updated>2010-04-05T00:00:00+10:00</updated>
   <id>http://florianhanke.com/blog/2010/04/05/javuby-question-mark</id>
   <content type="html">&lt;script src=&quot;http://gist.github.com/356227.js&quot;&gt;&lt;/script&gt;</content>
   
 </entry>
 
 
</feed>