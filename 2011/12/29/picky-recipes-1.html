<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-type" />
    <link href="/blog/favico.ico" rel="shortcut icon" />
    <!-- Ugh. -->
    <script src="/blog/javascripts/shjs-0.6/sh_main.min.js" type="text/javascript"></script>
    <link href="/blog/javascripts/shjs-0.6/css/sh_nedit.min.css" rel="stylesheet" type="text/css" />
    <link href="/blog/stylesheets/basic.css" rel="stylesheet" type="text/css" />
    <link href="/blog/stylesheets/specific.css" rel="stylesheet" type="text/css" />
    <!-- Ugh. -->
    <script src="/javascripts/shjs-0.6/sh_main.min.js" type="text/javascript"></script>
    <link href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono" rel="stylesheet" type="text/css" />
    <link href="/javascripts/shjs-0.6/css/sh_nedit.min.css" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/basic.css" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/specific.css" rel="stylesheet" type="text/css" />
    <title>Picky&nbsp;Recipes</title>
    <script type="text/javascript">
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-20991642-1']);
        _gaq.push(['_trackPageview']);
        
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      //]]>
    </script>
  </head>
  <body onload='sh_highlightDocument("/blog/javascripts/shjs-0.6/lang/", ".min.js");'>
    <ol class="nav">
      <li>
        <a href="/../">home</a>
        •
      </li>
      <li>
        <a href="/../blog/">blog</a>
        •
      </li>
      <li>
        <a href="/../picky/">picky</a>
        •
      </li>
      <li>
        <a href="/../phd/">phd</a>
        •
      </li>
      <li>
        <a href="/../phony/">phony</a>
        •
      </li>
      <li>
        <a href="/../view_models/">view models</a>
      </li>
    </ol>
    <div class="post">
      <h1>Picky&nbsp;Recipes</h1>
      <div class="categories">
        ruby / picky
      </div>
      <!-- /  - page.categories.each do |category| -->
      <!-- /    %a{ :href => "/blog/category/#{category}" }= category -->
      <p>I&#8217;m currently putting together a collection of Picky recipes.</p>
      <p>I noticed that people who wanted to try Picky had a bit of trouble getting into it. Sure, there is the <a href="http://florianhanke.com/picky/getting_started.html">getting started guide</a> on the <a href="http://florianhanke.com/picky">main page</a>. And there&#8217;s also videos and blog posts.</p>
      <h2>The Quick Demo Fix</h2>
      <p>BUT. The question I should have asked myself is: When I try something for the first time, what do I need? I guess, like many others, I am guilty of being rather lazy when trying software – I need a quick fix.</p>
      <p>This led me to put up a quick copy and paste code example on the <a href="http://florianhanke.com/picky">main page</a>. I haven&#8217;t received any feedback on it yet (except by a friend who urged me to use syntax highlighting), but I am happy with it. It shows the strengths of Picky off nicely.</p>
      <h2>Customized Search Engines in Projects</h2>
      <p>However, <strong>all</strong> of the Picky projects are projects where the search engine needed to be modified from a little to – mostly – a lot. And in all the cases I or someone else helped getting it right. I don&#8217;t believe this is a problem of Picky, but mostly a mixture of not knowing what options there are and the fact that Picky is not a &#8220;boolean&#8221; search engine framework.
      (And, I might add, some of the stunts would not be possible with a non-flexible search engine like … not-Picky)</p>
      <h2>The Recipes</h2>
      <p>This led me to start putting together a few examples which you can copy and paste quickly to see how something works and how it can be used.</p>
      <p>The <a href="http://github.com/floere/picky/tree/master/recipes">first 25 simple recipes</a> are pushed to the picky repo. You can clone the project, then run the recipes by using &#8220;rake&#8221; on the command line inside the recipes directory.</p>
      <p>Let me show one or two that I like to whet your appetite.</p>
      <h3>Realtime Indexing vs. Static Indexing</h3>
      <p>These examples illustrate how to use the static vs. the realtime index.</p>
      <p>See <a href="https://github.com/floere/picky/blob/master/recipes/basic/static_index.rb">https://github.com/floere/picky/blob/master/recipes/basic/static_index.rb</a> and <a href="https://github.com/floere/picky/blob/master/recipes/basic/realtime_index.rb">https://github.com/floere/picky/blob/master/recipes/basic/realtime_index.rb</a>.</p>
      <p>Static indexing is easier if you only index once per day and are happy to use <code>rake index</code>. Realtime indexing shows you how you can update the index as you get new data.</p>
      <h3>Only finds evenly sized partials</h3>
      <p>This is a bit of a silly recipe, but it illustrates well how easy it is to add a custom partializer.</p>
      <p>Partial searches refer to somebody being able to search for &#8220;flor&#8221; and still finding &#8220;florian&#8221; (use &#8220;flor*&#8221; to explicitly search partially for that word).</p>
      <p>Now what we want is to find only partial words whose length is even. This is the recipe for it: <a href="https://github.com/floere/picky/blob/master/recipes/partial/customized.rb">https://github.com/floere/picky/blob/master/recipes/partial/customized.rb</a>.</p>
      <p>To use it, we just pass in our own partializer</p>
      <pre class="ruby"><code>data = Picky::Index.new :people do&#x000A;  category :first  &#x000A;  category :last, partial: Partializer.new # &lt;= Passed in here.&#x000A;end</code></pre>
      <p>that is defined as</p>
      <pre class="ruby"><code>class Partializer&#x000A;  def each_partial text&#x000A;    temp = text.dup&#x000A;    temp.length.times do&#x000A;      yield temp if temp.size.even?&#x000A;      temp.chop!&#x000A;    end&#x000A;  end&#x000A;end</code></pre>
      <p>Picky just needs an object with an <code>each_partial</code> method. Our special partializer chops the word apart until it is gone, and yields if the word is of even length.</p>
      <p>Thus we only find a partial if of even length.</p>
      <p>Wasn&#8217;t that easy?</p>
      <h4>With a Twist</h4>
      <p>Thanks to it yielding, we could have just wrapped one of the given partializers to do the work for us.</p>
      <pre class="ruby"><code>class Partializer&#x000A;  def initialize wrapped = Picky::Partial::Postfix.new(from: 1)&#x000A;  	@wrapped = wrapped&#x000A;  end	&#x000A;  def each_partial text&#x000A;	  @wrapped.each_partial do |partial|&#x000A;	    yield partial if partial.size.even?&#x000A;	  end&#x000A;  end&#x000A;end</code></pre>
      <p>I like it! The partializer doesn&#8217;t really know what partializer it gets. However, it will still only yield partials that are of even length. Think of it as a filter when used in this style.</p>
      <h3>Context Sensitive Advertisements</h3>
      <p>Let&#8217;s say you want to search for people via name or location. In addition, you&#8217;d like to show an advertisement next to the search results corresponding to the location.</p>
      <p>See <a href="https://github.com/floere/picky/blob/master/recipes/advanced/advertisement.rb">https://github.com/floere/picky/blob/master/recipes/advanced/advertisement.rb</a>.</p>
      <p>So if someone searches for &#8220;Florian Melbourne&#8221;, it should find a Florian in Melbourne, but also show an ad from Melbourne.</p>
      <p>The problem is, if I just use two indexes (one for people, one for ads), if I search in both, the ad index won&#8217;t return any results if the query contains a name. So how do we make the ad search ignore <em>names</em>???</p>
      <p>Picky tries to assign every search word to a likely category. What we&#8217;d like is to only assign to locations, and if it is a name, to just ignore it.</p>
      <p>The magic thing to use here is <code>ignore_unassigned_tokens</code>. So if a name cannot be assigned to a category, it will simply be ignored. That&#8217;s it! Run the full example to see for yourself.</p>
      <h2>Yours?</h2>
      <p>If you have recipes to contribute, don&#8217;t be shy. I&#8217;d particularly be happy for a Rails one.</p>
      <h2>Outlook</h2>
      <p>I&#8217;ll be adding recipes as I go. What do you think? Do the recipes help? Do they bewilder you? Do you find what you are looking for? Why? Why not?</p>
      <br />
      Previous
      <a class="previous" href="/blog/2011/12/28/unthinking-autoloaders.html" title="Previous post: Unthinking&amp;nbsp;Autoloader">Unthinking&nbsp;Autoloader</a>
      <h2>Comments?</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        //<![CDATA[
          var disqus_shortname = 'florianhanke';
          var disqus_developer = location.host.match(/\.dev$|^localhost/) ? 1 : 0;
          var disqus_identifier = '/2011/12/29/picky-recipes-1';
          var disqus_url = 'http://florianhanke.com/blog/2011/12/29/picky-recipes-1.html';
          
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        //]]>
      </script>
      <noscript>
        Please enable JavaScript to view the
        <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
      </noscript>
    </div>
  </body>
</html>
