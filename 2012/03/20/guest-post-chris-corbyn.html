<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-type" />
    <link href="../../../favico.ico" rel="shortcut icon" />
    <script src="../../../javascripts/shjs-0.6/sh_main.min.js" type="text/javascript"></script>
    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <link href="../../../javascripts/shjs-0.6/css/sh_nedit.min.css" rel="stylesheet" type="text/css" />
    <link href="../../../stylesheets/basic.css" rel="stylesheet" type="text/css" />
    <link href="../../../stylesheets/specific.css" rel="stylesheet" type="text/css" />
    <title>Guest&nbsp;Post:&nbsp;Chris&nbsp;Corbyn&nbsp;of&nbsp;Flippa</title>
    <script type="text/javascript">
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-20991642-1']);
        _gaq.push(['_trackPageview']);
        
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      //]]>
    </script>
  </head>
  <body onload='sh_highlightDocument("../../../javascripts/shjs-0.6/lang/", ".min.js");'>
    <ol class="nav">
      <li>
        <a href="./../../../../">home</a>
        •
      </li>
      <li>
        <a href="./../../../">blog</a>
        •
      </li>
      <li>
        <a href="./../../../../picky/">picky</a>
        •
      </li>
      <li>
        <a href="./../../../../phd/">phd</a>
        •
      </li>
      <li>
        <a href="./../../../../phony/">phony</a>
        •
      </li>
      <li>
        <a href="./../../../../view_models/">view models</a>
      </li>
    </ol>
    <div class="post">
      <h1>
        Guest&nbsp;Post:&nbsp;Chris&nbsp;Corbyn&nbsp;of&nbsp;Flippa
        <a class="twitter-share-button" data-count="none" data-text="Guest&amp;nbsp;Post:&amp;nbsp;Chris&amp;nbsp;Corbyn&amp;nbsp;of&amp;nbsp;Flippa" data-url="http://florianhanke.com/blog/2012/03/20/guest-post-chris-corbyn.html" data-via="hanke" data-width="55px" href="http://twitter.com/share">Tweet</a>
      </h1>
      <div class="categories">
        search engine design / guest post
      </div>
      <!-- /  - page.categories.each do |category| -->
      <!-- /    %a{ :href => "/blog/category/#{category}" }= category -->
      <p>This is a great guest post by <a href="http://chriscorbyn.co.uk/">Chris Corbyn</a> where he explains the search engine journey undertaken by <a href="http://flippa.com">Flippa</a> and the decisions behind them.</p>
      <h2>Intro</h2>
      <p>(Later sections written by Chris Corbyn)</p>
      <p>Wondering why us developers don&#8217;t talk much more about search engine design, I asked on twitter:</p>
      <blockquote class="twitter-tweet"><p>App developers with searches: Am I the only one here who thinks search design should be much much more important than it is? I&#8217;m interested!</p><p>&mdash; Florian Hanke (@hanke) <a href="https://twitter.com/hanke/status/175850202840829952" data-datetime="2012-03-03T07:48:50+00:00">March 3, 2012</a></blockquote>
      <script src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
      <p>Subsequently, a few discussionlets developed with other people also interested in search engine design: <a href="https://twitter.com/#!/ezkl">@ezkl</a>, <a href="https://twitter.com/#!/_tomash">@_tomash</a>, <a href="https://twitter.com/#!/manfreds">@manfreds</a> and last but not least <a href="https://twitter.com/#!/d11wtq">@d11wtq</a>. Thanks all!</p>
      <p>The man behind the curious pseudonym <a href="https://twitter.com/#!/d11wtq">@d11wtq</a> was <a href="http://chriscorbyn.co.uk/">Chris Corbyn</a>, who took the time to respond in full on the design of <a href="http://flippa.com">Flippa</a>, &#8220;The #1 Marketplace for Buying and Selling Websites&#8221;, where the search engine takes center stage.</p>
      <p>With his gracious permission I am reprinting his email in full.</p>
      <p>In Chris&#8217; words:</p>
      <h2>&#8220;The motivation behind putting a focus on search</h2>
      <p>At Flippa, we&#8217;re currently up to our 3rd implementation of search and we consider it <strong>hugely</strong> important to the success of our business.  We&#8217;re something along the lines of an eBay platform, but built purely for buying and selling websites.  If buyers cannot find what they are looking for, we quickly lose those users, and if we don&#8217;t have buyers on the site, logically we lose the sellers who market to them.  I still think we have a lot of room to improve, but when we look back at our first implementation, we have come a long way.  I guess we have come to learn over time just how important search is, rather than it being something that was apparent to us right from the day we launched Flippa (three years ago).</p>
      <h2>The first implementation</h2>
      <p>When we built Flippa, we knew we needed a search, but the scope of this was simply something that had to exist so that users could find listings by keywords.  It was not something that was well-integrated with the rest of the application.  We used Solr (as was the fashion at the time) and search was just a &#8220;side feature&#8221; that was often forgotten about.  Users could enter a keyword and get a set of results in a listing format entirely different from the layout we use when browsing our listings via the primary navigation.  Users regularly complained, with reason… our search was more or less useless for their needs, which were far more complex than matching on keywords.</p>
      <h2>The second implementation</h2>
      <p>Acknowledging that users needed to be able to search on a range of metrics and that we needed to make some rather substantial changes to our search infrastructure, we sat down to discuss what our end goals were.  Our users are interested more in raw numbers, than in text (e.g. they search for websites based on revenue, on page views, on alexa rank, etc).  Users also wanted the ability to put together a custom search and save it to the database, so that when they returned to the site they could easily repeat a previous search.</p>
      <p>We decided that we effectively needed to build a complete model around our search system, providing all the criteria our users would search on, in such a way that a fully-built set of criteria would be saved into the database for re-use.  We also wanted to integrate our primary navigation with this search system.  I don&#8217;t remember what the driving force was behind using the same system for our primary navigation, but I suspect it was mostly about unifying the UI and the underlying model code, in addition to improving our categorization of listings—sellers could previously specify if their website was &#8220;high end&#8221; or &#8220;turnkey&#8221;, for example, but with this new search system we could determine such things by looking at the numbers, in realtime.</p>
      <p>We dropped Solr in favour of Sphinx, for two reasons:</p>
      <ol>
      	<li>Indexing time with MySQL was <strong>considerably</strong> faster.</li>
      	<li>It provided SphinxSE, which is a plugin for MySQL, allowing the index to be queried through MySQL.</li>
      </ol>
      <p>We built an advanced search library around Sphinx, allowing us to compose searches from a selection of pre-defined criteria, which were all exposed in the UI through our advanced search page.  Because of the MySQL integration, internally searches became a combination of full-text index querying + an <span class="caps">INNER</span> <span class="caps">JOIN</span> to our listings table in MySQL.  A sort of hybrid of MySQL and Sphinx full-text querying.  Searches could be saved to the database, though regrettably, as entire serialized objects.  We actually stored our primary navigation options this way in the database too.  This turned out to be a big mistake when it came to data portability.</p>
      <p>From our users&#8217; perspective, the search capabilities were good, but it was too difficult to use.  We had tried to provide all the options they could ever need, but the end result was that there were too many options, some of which seemed ambiguous and confusing.  Additionally, every time we changed the name of a search field, the serialized objects saved into the database broke, and the migration procedure was much more complicated than it should have been.</p>
      <p>Users also found it difficult to &#8220;narrow down&#8221; their search, since it wasn&#8217;t clear what impact changing an input in the advanced search would have on the size of the result set, without performing that search.</p>
      <p>At the time we built this particular search implementation, the only way to index your data with Sphinx was to rebuild the entire index.  Fortunately this only took about 20 seconds or so in our case (Sphinx is good at doing this stuff efficiently).  Though since we wanted close-to-realtime results (as our data changes practically every second or two), we were re-indexing the entire dataset every minute via cron, which was adding some strain to our database servers.</p>
      <h2>The third (and current) implementation</h2>
      <p>Generally we are happy with what have now, but we do have some things planned for further improvements.</p>
      <p>When we rewrote search this time around, beyond our desire to improve the underlying code internally, we wanted to make it easier for users to &#8220;visualize&#8221; the data as they browsed.  Since users were searching primarily on factors such as revenue and page views, we set about building a faceted search designed to allow click-by-click drill-down of the results, where the facets always show how many results you&#8217;ll get if you click on them.  The facets would be displayed all the time, no matter what you were searching for.  This presented some challenges, since now instead of executing a single query per search, we had to execute something like 20 queries.</p>
      <p>Like the previous implementation, we used Sphinx—albeit a newer version with support for realtime indexes and multi-queries, which is how the facets are able to execute efficiently.  We also retained the idea of having our primary navigation hooked into our search system.  This had worked well for us in the previous implementation.  We ditched SphinxSE due to the complexity it added to our server infrastructure and the fact we wanted to use multi-queries in Sphinx, which would not work efficiently through MySQL.  While we still use the search system for our primary navigation (which means you&#8217;ll always have facets down the side of the page), we stopped storing these in the database and simply have them formalized in code.  This makes tweaking them simpler, since it&#8217;s a code edit, not a data migration.  We also built a proper schema for saving searches, instead of being lazy and serializing objects to the database (the benefits of which, probably do not require further explanation).</p>
      <p>Since the primary complaint with our previous implementation, from the user experience perspective, was that it was too confusing to use, we spent a considerable amount of time assessing what options we were providing to users via our advanced search page.  It was overly complicated and ambiguous in places.  As a result, we decided to either remove search options entirely, or combine them together, thus greatly simplifying the UI for our users.  I believe at the same time, we added new options, but the end result was still simpler.  Part of this change, however, was designed to draw the focus away from the advanced search and more towards our pre-defined facets, which suit the needs of most casual users browsing the site.</p>
      <p>The feedback we&#8217;ve had from regarding our current search has been extremely positive.  Many of our listings are at the low end of the scale, which many buyers are not interested in.  Now buyers are able to quickly filter these out simply by clicking on the facets, directly from our primary navigation options.  This is something we were aiming to achieve… we&#8217;re looking to encourage more quality listings, so making it easier for buyers to reach these listings and hide the 3-day-old WordPress blogs solves this.</p>
      <p>All the code is custom-written in <span class="caps">PHP</span> (parts of our site are written in <span class="caps">PHP</span>, other parts are written in Ruby).  We&#8217;ll likely be porting this code to Ruby at some point, though we need a Sphinx gem that supports the features we&#8217;re using from Sphinx 2, and Pat Allan&#8217;s Riddle gem doesn&#8217;t offer this just yet.  We may end up writing this ourselves.</p>
      <h2>Some things we have built around our search</h2>
      <ul>
      	<li>From any of our primary navigation options, you may click &#8220;Advanced&#8221; at the top of the facets, to load the advanced search page with the inputs used to execute the search for that navigation option, either for inspection, or to modify them.</li>
      	<li>We have a <span class="caps">JSON</span> search <span class="caps">API</span>, available only on request, used by third-parties who analyze our data for use on their own websites.</li>
      	<li>Users can have the results of a search emailed to them on a daily basis.  This simply loads the search from the database and executes it via a background job.</li>
      	<li>Some smaller features, such as watching certain tags and sellers use the search internally.</li>
      </ul>
      <h2>Where to next?</h2>
      <p>We have some things on the agenda for future improvements to our search, though nothing quite as major as our previous iterations.  There are some internal optimizations we can certainly make, such as having an effective caching strategy (though cache invalidation is <strong>hard</strong>).  We also have some changes planned that focus on tailoring the search according to the region of the user, though I can&#8217;t go into details on this.  All in all, we think we&#8217;re getting there!&quot;</p>
      <h2>Thanks / Guest Posts</h2>
      <p>Many thanks to Chris! Please post feedback right here or send to <a href="http://twitter.com/d11wtq">Chris&#8217; Twitter</a>.</p>
      <p>If you don&#8217;t have a blog or are interested in writing a guest post, roughly in these areas: Ruby, Framework Design, Search Design or similar, please <a href="http://twitter.com/hanke">contact me</a>.</p>
      Next
      <a href="/blog/2012/06/25/business-cards.html" title="Next post: Business&amp;nbsp;Cards">Business&nbsp;Cards</a>
      <h2>Share</h2>
      <p>
        <a class="twitter-share-button" data-count="none" data-text="Guest&amp;nbsp;Post:&amp;nbsp;Chris&amp;nbsp;Corbyn&amp;nbsp;of&amp;nbsp;Flippa" data-url="http://florianhanke.com/blog/2012/03/20/guest-post-chris-corbyn.html" data-via="hanke" data-width="55px" href="http://twitter.com/share">Tweet</a>
      </p>
      <br />
      Previous
      <a class="previous" href="../../../2012/03/16/normalize-indexed-data.html" title="Previous post: Normalizing&amp;nbsp;Indexed&amp;nbsp;Data">Normalizing&nbsp;Indexed&nbsp;Data</a>
      <h2>Comments?</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        //<![CDATA[
          var disqus_shortname = 'florianhanke';
          var disqus_developer = location.host.match(/\.dev$|^localhost/) ? 1 : 0;
          var disqus_identifier = '/2012/03/20/guest-post-chris-corbyn';
          var disqus_url = 'http://florianhanke.com/blog/2012/03/20/guest-post-chris-corbyn.html';
          
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        //]]>
      </script>
      <noscript>
        Please enable JavaScript to view the
        <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
      </noscript>
    </div>
  </body>
</html>
